# 🔧 Static Binaries - Portable Tool Deployment

Using pre-compiled static binaries for tool deployment on compromised systems without dependencies.
**Location:** `10-post-exploitation/tool-deployment/static-binaries-usage.md`

## 🎯 What are Static Binaries?
Static binaries are pre-compiled executables that include all necessary libraries and dependencies, allowing them to run on target systems without requiring additional software installation. This technique is essential for deploying reconnaissance tools like Nmap on compromised systems that lack standard penetration testing tools.

## 📦 Static Binary Locations and Setup

### Common Static Binary Locations:
```bash
# Kali Linux standard locations
ls -al /root/static-binaries/

# Expected contents:
# -rwxr-xr-x nmap (5.82 MB static compilation)
# -rwxr-xr-x nc (netcat static binary)
# -rwxr-xr-x socat (socket relay tool)
```

### Verification Commands:
```bash
# Check if binary is statically linked
file /root/static-binaries/nmap
# Output: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked

# Test binary functionality
/root/static-binaries/nmap --version
# Output: Nmap version info without dependency issues
```

## 🔧 Deployment and Usage

### Binary Upload Process:
```bash
# From Meterpreter session
meterpreter > upload /root/static-binaries/nmap /tmp/nmap
# [*] Uploading: /root/static-binaries/nmap → /tmp/nmap
# [*] Uploaded -1.00 B of 5.82 MiB (0.0%): /root/static-binaries/nmap → /tmp/nmap
# [*] Completed: /root/static-binaries/nmap → /tmp/nmap

# Make binary executable
meterpreter > shell
cd /tmp/
chmod +x ./nmap
```

## ⚙️ Static Binary Usage Options

### Basic Execution Commands:
| Command | Purpose | Example |
|---------|---------|---------|
| `./nmap -p- target` | Full port scan | `./nmap -p- 192.180.108.3` |
| `./nmap -sV target` | Version detection | `./nmap -sV 192.180.108.3` |
| `./nmap -A target` | Aggressive scan | `./nmap -A 192.180.108.3` |
| `file binary_name` | Check binary type | `file ./nmap` |
| `./binary --version` | Version verification | `./nmap --version` |

### Network Discovery Options:
| Scan Type | Command | Purpose |
|-----------|---------|---------|
| Basic Port Scan | `./nmap target` | Default 1000 ports |
| Full Port Scan | `./nmap -p- target` | All 65535 ports |
| Service Detection | `./nmap -sV -p21,22,80 target` | Identify services |
| Quick Scan | `./nmap -F target` | Fast 100 common ports |

## 🧪 Real Lab Examples

### Example 1: Nmap Static Binary Upload and Execution
```bash
# Phase 1: Upload from Meterpreter session
meterpreter > upload /root/static-binaries/nmap /tmp/nmap
# [*] Uploading: /root/static-binaries/nmap → /tmp/nmap
# [*] Uploaded -1.00 B of 5.82 MiB (0.0%): /root/static-binaries/nmap → /tmp/nmap
# [*] Completed: /root/static-binaries/nmap → /tmp/nmap

# Phase 2: Set permissions and execute
meterpreter > shell
cd /tmp/
chmod +x ./nmap

# Phase 3: Perform network scan on pivot network
./nmap -p- 192.180.108.3

# Expected Output:
# Starting Nmap 7.70 ( https://nmap.org ) at 2024-11-26 07:57 UTC
# Unable to find nmap-services! Resorting to /etc/services
# Cannot find nmap-payloads. UDP payloads are disabled.
# Nmap scan report for 192.180.108.3
# Host is up (0.003s latency).
# Not shown: 65532 closed ports
# PORT    STATE SERVICE
# 21/tcp  open  ftp
# 22/tcp  open  ssh
# 80/tcp  open  http
# Nmap done: 1 IP address (1 host up) scanned in 19.97 seconds
```

### Example 2: Service Version Detection
```bash
# Enhanced scanning with service detection
./nmap -sV -p21,22,80 192.180.108.3

# Expected Output:
# Starting Nmap 7.70 ( https://nmap.org ) at 2024-11-26 08:15 UTC
# Nmap scan report for 192.180.108.3
# Host is up (0.002s latency).
# PORT   STATE SERVICE VERSION
# 21/tcp open  ftp     vsftpd 3.0.3
# 22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (SSH-2.0-OpenSSH_7.9p1 Debian-10+deb10u2)
# 80/tcp open  http    Apache httpd 2.4.38 ((Debian))
# Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
# Nmap done: 1 IP address (1 host up) scanned in 8.42 seconds
```

### Example 3: Multiple Tool Deployment
```bash
# Upload multiple static binaries
meterpreter > upload /root/static-binaries/nmap /tmp/nmap
meterpreter > upload /root/static-binaries/nc /tmp/nc
meterpreter > upload /root/bash-port-scanner.sh /tmp/bash-port-scanner.sh

# Set permissions for all tools
meterpreter > shell
cd /tmp/
chmod +x ./nmap ./nc ./bash-port-scanner.sh

# Compare scanning methods
./bash-port-scanner.sh 192.180.108.3  # Bash method
./nmap -p1-1000 192.180.108.3          # Nmap method

# Both should identify ports 21, 22, and 80 as open
```

### Example 4: Network Range Scanning
```bash
# Scan entire subnet using static Nmap
./nmap -sn 192.180.108.0/24

# Expected output showing live hosts:
# Nmap scan report for 192.180.108.1
# Host is up (0.001s latency).
# Nmap scan report for 192.180.108.3
# Host is up (0.002s latency).
# Nmap done: 256 IP addresses (2 hosts up) scanned in 3.45 seconds

# Follow up with port scanning on discovered hosts
./nmap -p- 192.180.108.1 192.180.108.3
```

## 🎯 eJPT Exam Focus

### Essential Skills for eJPT:
- **Tool Upload Techniques** - Deploy static binaries via compromised systems
- **Permission Management** - Configure executable permissions on uploaded tools
- **Network Reconnaissance** - Use deployed tools for internal network discovery
- **Comparison Analysis** - Validate results using multiple scanning methods

### Critical Commands to Master:
```bash
# File upload and deployment sequence
upload /path/to/static/binary /tmp/binary_name    # Upload via meterpreter
chmod +x /tmp/binary_name                         # Set executable permissions
./binary_name [options] target                    # Execute with parameters
file ./binary_name                               # Verify binary type and linking
```

### eJPT Exam Scenarios:
1. **Internal Network Discovery Scenario:**
   - Required skills: Static binary deployment, network scanning
   - Expected commands: `upload`, `chmod +x`, `./nmap -sn network/mask`
   - Success criteria: Identify additional systems on internal networks

2. **Service Enumeration Scenario:**
   - Required skills: Port scanning, service identification
   - Expected commands: `./nmap -sV -p ports target`, service version analysis
   - Success criteria: Determine running services and versions for exploit selection

3. **Tool Comparison Scenario:**
   - Required skills: Multiple scanning techniques, result validation
   - Expected commands: Both bash scripts and static nmap execution
   - Success criteria: Consistent results across different scanning methods

### Exam Tips and Tricks:
- **Tip 1:** Always verify binary integrity with `file` command before execution
- **Tip 2:** Use `/tmp/` directory for tool deployment as it's typically writable
- **Tip 3:** Test tools with `--version` flag to ensure proper functionality
- **Tip 4:** Compare results between custom scripts and standard tools for accuracy

### Common eJPT Questions:
- How to deploy reconnaissance tools on systems without package managers
- Verification methods for static binary integrity and functionality

## ⚠️ Common Issues & Troubleshooting

### Issue 1: Binary Architecture Mismatch
**Problem:** Static binary fails to execute due to architecture incompatibility
**Cause:** Wrong CPU architecture (x86 vs x64) or incompatible instruction set
**Solution:**
```bash
# Check target system architecture
uname -m
cat /proc/cpuinfo | grep "model name"

# Verify binary architecture
file /tmp/nmap
# Should match target system architecture

# Use architecture-specific binaries
# For x86_64: use 64-bit static binaries
# For i386: use 32-bit static binaries
```

### Issue 2: Permission Denied During Execution
**Problem:** Cannot execute uploaded binary despite setting permissions
**Cause:** File system mounted with noexec option or SELinux restrictions
**Solution:**
```bash
# Check mount options
mount | grep /tmp
# Look for 'noexec' flag

# Alternative execution locations
mkdir /dev/shm/tools    # RAM-based filesystem
cp /tmp/nmap /dev/shm/tools/
chmod +x /dev/shm/tools/nmap
/dev/shm/tools/nmap target
```

### Issue 3: Missing Dependencies Warning
**Problem:** Static binary reports missing nmap-services or nmap-scripts
**Cause:** Auxiliary files not included with static compilation
**Prevention:**
```bash
# Create basic services file
echo "21/tcp ftp" > /tmp/services
echo "22/tcp ssh" >> /tmp/services  
echo "80/tcp http" >> /tmp/services
export NMAPDIR=/tmp

# Alternative: Use basic port specification
./nmap -p21,22,80 target  # Specify ports directly
```

### Issue 4: Slow Performance on Large Networks
**Problem:** Static binary scanning performs slower than expected
**Optimization:**
```bash
# Use parallel scanning techniques
./nmap -T4 --min-rate 1000 target     # Faster timing template
./nmap -p- --max-retries 1 target     # Reduce retry attempts
./nmap -sS target                      # SYN scan (faster than connect)
```

## 🔗 Integration with Other Tools

### Primary Integration: Meterpreter → Static Binaries → Intelligence Gathering
```bash
# Complete workflow showing tool integration
meterpreter > upload /root/static-binaries/nmap /tmp/nmap     # Deploy tool
meterpreter > shell                                          # Access shell
chmod +x /tmp/nmap                                          # Set permissions
./nmap -sn network/24 > discovered_hosts.txt               # Network discovery
./nmap -sV $(cat discovered_hosts.txt) > service_scan.txt  # Service enumeration

# Explanation of each step:
# Step 1: Meterpreter provides file upload capability
# Step 2: Shell access allows tool execution and permission management
# Step 3: Static binary performs reconnaissance without external dependencies
```

### Secondary Integration: Static Tools → Exploit Module Selection
```bash
# How scanning results guide exploit selection
./nmap -sV target > scan_results.txt                        # Service detection
grep "ftp\|ssh\|http" scan_results.txt                     # Extract key services
# Results inform Metasploit module selection:
# FTP → auxiliary/scanner/ftp/ftp_version
# SSH → auxiliary/scanner/ssh/ssh_version  
# HTTP → auxiliary/scanner/http/http_version
```

### Advanced Workflows:
```bash
# Complex reconnaissance pipeline
./nmap -sn 192.168.0.0/24 | grep "Nmap scan report" | cut -d" " -f5 > live_hosts.txt
for host in $(cat live_hosts.txt); do
  ./nmap -sV -p1-1000 $host > scan_$host.txt &
done
wait
# Parallel scanning of discovered hosts with result aggregation
```

## 📝 Documentation and Reporting

### Evidence Collection Requirements:
1. **Screenshots:** Binary upload process, permission settings, scan execution
2. **Command Outputs:** All scan results with timestamps and target information
3. **Binary Information:** File signatures, architecture details, version info
4. **Comparison Results:** Validation between different scanning methods

### Report Template Structure:
```markdown
## Static Binary Deployment Results

### Target System Information
- Compromised System: 192.63.4.3
- Target Network: 192.180.108.0/24
- Date/Time: 2024-11-26 07:57 UTC
- Binary Used: nmap v7.70 (static compilation)

### Deployment Process
#### Binary Upload
```bash
meterpreter > upload /root/static-binaries/nmap /tmp/nmap
# [*] Completed: /root/static-binaries/nmap → /tmp/nmap (5.82 MiB)
```

#### Permission Configuration
```bash
chmod +x /tmp/nmap
file /tmp/nmap
# ELF 64-bit LSB executable, x86-64, statically linked
```

### Scanning Results
#### Network Discovery
- **Command:** `./nmap -sn 192.180.108.0/24`
- **Live Hosts:** 192.180.108.1, 192.180.108.3
- **Scan Duration:** 3.45 seconds

#### Service Enumeration
- **Target:** 192.180.108.3
- **Open Ports:** 21/tcp (FTP), 22/tcp (SSH), 80/tcp (HTTP)
- **Service Versions:** vsftpd 3.0.3, OpenSSH 7.9p1, Apache httpd 2.4.38

### Key Findings
- Successfully deployed reconnaissance tools on compromised system
- Identified additional target systems on internal network segment
- Confirmed service versions for exploit module selection
- Validated results using multiple scanning techniques

### Recommendations
- Implement network segmentation to prevent lateral reconnaissance
- Monitor for unusual process execution patterns
- Restrict write permissions in temporary directories
- Deploy endpoint detection and response solutions
```

### Automation Scripts:
```bash
# Automated deployment and scanning script
#!/bin/bash
# auto_deploy_scan.sh

# Deploy static binary
meterpreter -x "upload /root/static-binaries/nmap /tmp/nmap; shell"

# Configure and execute
cat << 'EOF' > /tmp/scan_script.sh
#!/bin/bash
cd /tmp
chmod +x ./nmap
./nmap -sn $1/24 > network_discovery.txt
./nmap -sV $(grep "Nmap scan report" network_discovery.txt | cut -d" " -f5) > service_scan.txt
EOF

bash /tmp/scan_script.sh $TARGET_NETWORK
```

## 📚 Additional Resources

### Static Binary Sources:
- Static binaries collection: https://github.com/andrew-d/static-binaries
- Nmap static compilation: https://github.com/ernw/static-toolbox
- Custom compilation guides: https://nullsec.us/static-binaries/

### Learning Resources:
- Static linking techniques: Advanced compilation methods
- Post-exploitation reconnaissance: Internal network discovery strategies
- Binary deployment best practices: Stealth and persistence techniques

### Community Resources:
- Penetration testing forums: Static tool deployment discussions
- GitHub repositories: Pre-compiled binary collections
- Security research blogs: Tool deployment case studies

### Related Tools:
- **UPX Packer:** Binary compression for smaller file sizes
- **Cross-compilation tools:** Build binaries for different architectures
- **Portable applications:** Self-contained tool packages
