# üîç Information Gathering - Reconnaissance Fundamentals

**Master reconnaissance techniques for effective penetration testing and eJPT success**
**Location:** `01-theory-foundations/pentesting-methodology/information-gathering.md`

## üéØ What is Information Gathering?

Information gathering, also known as reconnaissance, is the first and most critical phase of penetration testing. It involves collecting as much information as possible about the target environment without directly interacting with target systems (passive) or with minimal interaction (active). For eJPT candidates, mastering information gathering is essential as it forms the foundation for all subsequent testing phases and accounts for approximately 23% of the exam content under "Host & Network Auditing."

Effective information gathering helps identify attack surfaces, understand network topology, discover services and technologies, and plan targeted exploitation strategies.

## üì¶ Information Gathering Categories

### Passive Reconnaissance:
```bash
# No direct interaction with target systems
# Uses publicly available information sources
# Difficult for target to detect
# Examples: OSINT, public databases, search engines

# Key characteristics:
- Undetectable by target
- Uses third-party sources
- Legal in most jurisdictions
- Foundation for active reconnaissance
```

### Active Reconnaissance:
```bash
# Direct interaction with target systems
# Generates network traffic to target
# Potentially detectable by monitoring systems
# Examples: port scanning, service enumeration

# Key characteristics:
- Direct target interaction
- Generates logs and alerts
- More detailed information
- Requires legal authorization
```

### Semi-Active Reconnaissance:
```bash
# Indirect interaction through intermediary systems
# Queries DNS servers, WHOIS databases
# Lower detection risk than active reconnaissance
# Examples: DNS enumeration, WHOIS queries
```

## üîß Passive Information Gathering Techniques

### Domain and Organization Intelligence:
```bash
# WHOIS database queries
whois target-domain.com
whois target-ip-address

# Domain registration information
# - Registrant details
# - Administrative contacts
# - Technical contacts
# - Name servers
# - Registration and expiration dates

# Expected output analysis:
# Registrant Organization: Target Company Inc.
# Admin Email: admin@target-domain.com
# Tech Email: tech@target-domain.com
# Name Servers: ns1.target-domain.com, ns2.target-domain.com
```

### Search Engine Intelligence (Google Dorking):
```bash
# Advanced search operators for information gathering
site:target-domain.com              # All indexed pages
site:target-domain.com filetype:pdf # PDF documents
site:target-domain.com inurl:admin  # Admin interfaces
site:target-domain.com intitle:login # Login pages

# Common Google dorks for penetration testing:
site:target.com "confidential"      # Confidential documents
site:target.com filetype:xlsx       # Excel files
site:target.com "password"          # Password-related content
site:target.com inurl:wp-admin      # WordPress admin panels
```

### Social Media Intelligence (SOCMINT):
```bash
# Social media reconnaissance techniques
# LinkedIn: Employee enumeration, organizational structure
# Facebook: Personal information, relationships
# Twitter: Public communications, technologies used
# GitHub: Code repositories, configuration files

# Information targets:
- Employee names and roles
- Technology stack information
- Email address formats
- Company structure and relationships
```

### Public Database Mining:
```bash
# Certificate transparency logs
# Shodan.io for internet-connected devices
# Archive.org for historical website data
# Pastebin for leaked information
# Have I Been Pwned for breach data

# Automated OSINT tools
theharvester -d target-domain.com -l 100 -b google
theharvester -d target-domain.com -l 100 -b bing
recon-ng
maltego
```

## ‚öôÔ∏è Active Information Gathering Techniques

### Network Discovery:
```bash
# Ping sweeps for live host identification
nmap -sn 192.168.1.0/24           # ICMP ping sweep
nmap -PS 192.168.1.0/24           # TCP SYN ping
nmap -PA 192.168.1.0/24           # TCP ACK ping
nmap -PU 192.168.1.0/24           # UDP ping

# Alternative discovery methods
fping -a -g 192.168.1.0/24        # Fast ping sweep
netdiscover -r 192.168.1.0/24     # ARP-based discovery
arp-scan -l                       # Local network ARP scan

# Expected results:
# Nmap scan report for 192.168.1.1 (gateway)
# Nmap scan report for 192.168.1.100 (target)
# Nmap scan report for 192.168.1.150 (additional host)
```

### Port Scanning and Service Discovery:
```bash
# TCP port scanning strategies
nmap -sS --top-ports 1000 target_ip    # Quick SYN scan
nmap -sS -p 1-65535 target_ip          # Full TCP scan
nmap -sT target_ip                     # Connect scan
nmap -sF target_ip                     # FIN scan (stealth)

# UDP port scanning
nmap -sU --top-ports 100 target_ip     # UDP scan
nmap -sU -p 53,161,123,514 target_ip   # Specific UDP services

# Service version detection
nmap -sV -p discovered_ports target_ip
nmap -sV --version-intensity 9 target_ip

# Example output:
# 22/tcp  open  ssh     OpenSSH 8.2p1 Ubuntu
# 80/tcp  open  http    Apache httpd 2.4.41
# 443/tcp open  https   Apache httpd 2.4.41 (SSL-only)
```

### DNS Enumeration:
```bash
# Basic DNS queries
nslookup target-domain.com
dig target-domain.com
dig @8.8.8.8 target-domain.com

# DNS record enumeration
dig target-domain.com A            # A records
dig target-domain.com MX           # Mail servers
dig target-domain.com NS           # Name servers
dig target-domain.com TXT          # Text records
dig target-domain.com SOA          # Start of Authority

# DNS zone transfer attempts
dig @ns1.target-domain.com target-domain.com AXFR
dnsrecon -d target-domain.com -t axfr

# Subdomain enumeration
dnsrecon -d target-domain.com -t brt -D /usr/share/wordlists/dnsmap.txt
sublist3r -d target-domain.com
```

## üß™ Real Lab Examples

### Example 1: Comprehensive Network Discovery
```bash
# Phase 1: Initial network identification
ip route show
# Output: default via 192.168.1.1 dev eth0
#         192.168.1.0/24 dev eth0 scope link

# Phase 2: Live host discovery
nmap -sn 192.168.1.0/24
# Output:
# Nmap scan report for 192.168.1.1
# Host is up (0.001s latency).
# Nmap scan report for 192.168.1.100
# Host is up (0.002s latency).
# Nmap scan report for 192.168.1.150
# Host is up (0.003s latency).

# Phase 3: ARP table analysis
arp -a
# Output:
# gateway (192.168.1.1) at 00:50:56:12:34:56 [ether] on eth0
# target (192.168.1.100) at 00:0c:29:ab:cd:ef [ether] on eth0
```

### Example 2: Service Enumeration and Fingerprinting
```bash
# Initial port scan
nmap -sS --top-ports 1000 192.168.1.100
# Output:
# 21/tcp  open  ftp
# 22/tcp  open  ssh
# 80/tcp  open  http
# 443/tcp open  https
# 3306/tcp open mysql

# Detailed service detection
nmap -sV -sC -p 21,22,80,443,3306 192.168.1.100
# Output:
# 21/tcp  open  ftp     vsftpd 3.0.3
# | ftp-anon: Anonymous FTP login allowed
# 22/tcp  open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5
# 80/tcp  open  http    Apache httpd 2.4.41 ((Ubuntu))
# |_http-title: Welcome to Target Web Server
# 443/tcp open  https   Apache httpd 2.4.41
# 3306/tcp open mysql   MySQL 8.0.25-0ubuntu0.20.04.1
```

### Example 3: Web Application Reconnaissance
```bash
# Technology identification
whatweb http://192.168.1.100
# Output:
# http://192.168.1.100 [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], 
# HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], 
# IP[192.168.1.100], PHP[7.4.3], Title[Welcome to Target Web Server]

# HTTP header analysis
curl -I http://192.168.1.100
# Output:
# HTTP/1.1 200 OK
# Date: Mon, 15 Jan 2025 20:30:00 GMT
# Server: Apache/2.4.41 (Ubuntu)
# X-Powered-By: PHP/7.4.3
# Content-Type: text/html; charset=UTF-8

# Directory enumeration
gobuster dir -u http://192.168.1.100 -w /usr/share/wordlists/dirb/common.txt
# Output:
# /admin               (Status: 200) [Size: 1234]
# /backup              (Status: 200) [Size: 567]
# /uploads             (Status: 200) [Size: 890]
```

### Example 4: Database Service Enumeration
```bash
# MySQL service enumeration
nmap --script mysql-info -p 3306 192.168.1.100
# Output:
# 3306/tcp open  mysql
# | mysql-info:
# |   Protocol: 10
# |   Version: 8.0.25-0ubuntu0.20.04.1
# |   Thread ID: 12
# |   Capabilities flags: 65535
# |   Some Capabilities: LongColumnFlag, Transactions, Protocol41

# Banner grabbing
nc 192.168.1.100 3306
# Output: MySQL version information and capabilities
```

## üéØ eJPT Exam Focus

### Essential Skills for eJPT (23% of exam - Host & Network Auditing):
- **Network discovery** and host identification (30%)
- **Port scanning** and service enumeration (35%)
- **Service fingerprinting** and version detection (25%)
- **Information correlation** and attack surface mapping (10%)

### Critical Information Gathering Commands for eJPT:
```bash
# Network discovery essentials
nmap -sn network/cidr               # Ping sweep
netdiscover -r network/cidr         # ARP discovery
arp-scan -l                         # Local ARP scan

# Port scanning essentials
nmap -sS --top-ports 1000 target   # Quick TCP scan
nmap -sU --top-ports 100 target    # Quick UDP scan
nmap -sV discovered_ports target   # Service detection

# Service enumeration essentials
nmap -sC target                     # Default scripts
whatweb http://target               # Web technology detection
curl -I http://target               # HTTP headers
```

### eJPT Exam Scenarios:
1. **Network Mapping Exercise:** Complete network topology discovery
   - Required skills: Network discovery, host enumeration, service mapping
   - Expected commands: Systematic scanning progression
   - Success criteria: Complete network map with all active hosts and services

2. **Service Identification Challenge:** Comprehensive service enumeration
   - Required skills: Port scanning, service detection, technology identification
   - Expected commands: Multi-phase scanning approach
   - Success criteria: Accurate service identification with versions

3. **Web Application Discovery:** Web-based asset identification
   - Required skills: Web reconnaissance, directory enumeration, technology detection
   - Expected commands: Web-specific enumeration tools
   - Success criteria: Complete web application inventory

### Exam Tips and Tricks:
- **Tip 1:** Always start with network discovery before targeted scanning
- **Tip 2:** Use both TCP and UDP scanning for complete coverage
- **Tip 3:** Document all findings systematically for later reference
- **Tip 4:** Correlate information from multiple sources for accuracy

### Common eJPT Questions:
- Identify all active hosts in a given network range
- Enumerate all services running on discovered hosts
- Determine web server technology and version
- Map network topology and service relationships

## ‚ö†Ô∏è Common Issues & Troubleshooting

### Issue 1: Incomplete Network Discovery
**Problem:** Missing hosts during network discovery phase
**Cause:** Relying on single discovery method or ICMP filtering
**Solution:**
```bash
# Use multiple discovery techniques
nmap -sn target_network             # ICMP ping
nmap -PS target_network             # TCP SYN ping
nmap -PA target_network             # TCP ACK ping
netdiscover -r target_network       # ARP discovery
arp-scan target_network             # ARP scan
```

### Issue 2: Service Detection Failures
**Problem:** Nmap showing "unknown" for service versions
**Cause:** Non-standard service configurations or version hiding
**Solution:**
```bash
# Enhanced service detection
nmap -sV --version-intensity 9 target
nmap -sV --version-all target
# Manual banner grabbing
nc target port
telnet target port
```

### Issue 3: False Positive Results
**Problem:** Tools reporting incorrect or non-existent services
**Cause:** Firewall responses, honeypots, or tool limitations
**Solution:**
```bash
# Manual verification approach
# Verify with multiple tools
nmap -sS target
masscan -p ports target
# Manual connection testing
nc -nv target port
telnet target port
```

### Issue 4: Information Overload
**Problem:** Collecting too much irrelevant information
**Cause:** Unfocused reconnaissance approach
**Solution:**
```bash
# Structured information gathering
# 1. Define specific objectives
# 2. Use targeted queries
# 3. Filter and organize results
# 4. Focus on actionable intelligence
```

## üîó Integration with Other Testing Phases

### Information Gathering ‚Üí Vulnerability Assessment:
```bash
# Progressive methodology
# 1. Network discovery
nmap -sn network_range > live_hosts.txt

# 2. Service enumeration
for host in $(cat live_hosts.txt); do
    nmap -sS -sV -p 1-1000 $host >> services.txt
done

# 3. Feed results to vulnerability assessment
nmap --script vuln $(cat live_hosts.txt)
```

### Service-Specific Information Gathering:
```bash
# Web services discovered
gobuster dir -u http://target -w wordlist
nikto -h http://target

# Database services discovered
nmap --script mysql-* -p 3306 target
nmap --script ms-sql-* -p 1433 target

# SSH services discovered
ssh-audit target
nmap --script ssh-* -p 22 target

# SMB services discovered
enum4linux target
smbclient -L //target
```

### Advanced Integration Workflows:
```bash
# Automated information gathering pipeline
# 1. Initial discovery
nmap -sn network/24 | grep "Nmap scan report" | cut -d' ' -f5 > hosts.txt

# 2. Port scanning
nmap -sS --top-ports 1000 -iL hosts.txt -oA port_scan

# 3. Service enumeration
nmap -sV -sC -iL hosts.txt -oA service_scan

# 4. Web service discovery
for host in $(cat hosts.txt); do
    if nmap -p 80,443,8080,8443 $host | grep open; then
        echo $host >> web_hosts.txt
    fi
done

# 5. Web enumeration
for host in $(cat web_hosts.txt); do
    gobuster dir -u http://$host -w wordlist -o ${host}_dirs.txt
done
```

## üìù Documentation and Reporting

### Information Gathering Documentation Requirements:
1. **Network Topology:** Visual network map with all discovered hosts
2. **Service Inventory:** Complete list of all identified services with versions
3. **Technology Stack:** Web technologies, databases, operating systems
4. **Attack Surface Analysis:** Potential entry points and attack vectors

### Documentation Template:
```markdown
## Information Gathering Results

### Network Discovery Summary
- **Target Network:** 192.168.1.0/24
- **Discovery Method:** Nmap ping sweep, ARP scan
- **Active Hosts:** 15 hosts discovered
- **Scan Date:** 2025-01-15 21:00

### Host Inventory
| IP Address | Hostname | MAC Address | Status |
|------------|----------|-------------|---------|
| 192.168.1.1 | gateway | 00:50:56:12:34:56 | Up |
| 192.168.1.100 | target | 00:0c:29:ab:cd:ef | Up |
| 192.168.1.150 | server | 00:0c:29:12:34:56 | Up |

### Service Discovery Summary
```bash
nmap -sS -sV -p 1-1000 192.168.1.0/24
```

#### Host: 192.168.1.100
- **22/tcp:** SSH (OpenSSH 8.2p1)
- **80/tcp:** HTTP (Apache 2.4.41)
- **443/tcp:** HTTPS (Apache 2.4.41)
- **3306/tcp:** MySQL (8.0.25)

### Web Application Inventory
```bash
gobuster dir -u http://192.168.1.100 -w common.txt
```
- **/admin:** Admin interface (200)
- **/backup:** Backup directory (200)
- **/uploads:** File upload location (200)

### Technology Stack Analysis
- **Web Server:** Apache 2.4.41
- **Scripting:** PHP 7.4.3
- **Database:** MySQL 8.0.25
- **Operating System:** Ubuntu Linux

### Attack Surface Assessment
**High Priority Targets:**
- Web applications (ports 80, 443)
- Database service (port 3306)
- Admin interfaces (/admin directory)

**Potential Attack Vectors:**
- Web application vulnerabilities
- Database access attempts
- File upload exploitation
- SSH brute force attacks
```

## üìö Information Gathering Quick Reference

### Essential Nmap Commands:
```bash
# Discovery scans
nmap -sn network/cidr              # Ping sweep
nmap -sL network/cidr              # List scan (DNS resolution)
nmap -PS port_list network/cidr    # TCP SYN ping
nmap -PA port_list network/cidr    # TCP ACK ping

# Port scanning
nmap -sS target                    # SYN scan
nmap -sT target                    # Connect scan
nmap -sU target                    # UDP scan
nmap -sF target                    # FIN scan

# Service detection
nmap -sV target                    # Version detection
nmap -sC target                    # Default scripts
nmap -A target                     # Aggressive scan (OS, version, scripts)
```

### Web Reconnaissance Tools:
```bash
# Technology identification
whatweb http://target              # Web technology scanner
wafw00f http://target             # WAF detection
builtwith http://target           # Technology profiler

# Directory enumeration
gobuster dir -u http://target -w wordlist
dirb http://target
feroxbuster -u http://target

# Content discovery
gobuster dns -d target.com -w wordlist    # Subdomain enumeration
ffuf -w wordlist -u http://target/FUZZ    # Content fuzzing
```

### Database and Service Enumeration:
```bash
# MySQL enumeration
nmap --script mysql-* -p 3306 target

# MSSQL enumeration
nmap --script ms-sql-* -p 1433 target

# SMB enumeration
enum4linux target
smbclient -L //target

# SNMP enumeration
snmpwalk -c public -v1 target
```
